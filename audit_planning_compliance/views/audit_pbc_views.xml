<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="view_audit_pbc_request_tree" model="ir.ui.view">
        <field name="name">audit.pbc.request.tree</field>
        <field name="model">audit.pbc.request</field>
        <field name="arch" type="xml">
            <tree decoration-danger="delivery_status == 'incomplete'" decoration-success="delivery_status == 'received'">
                <field name="name"/>
                <field name="engagement_id"/>
                <field name="category"/>
                <field name="responsible_client_contact"/>
                <field name="due_date"/>
                <field name="delivery_status"/>
                <field name="reminder_count"/>
                <field name="escalation_level"/>
            </tree>
        </field>
    </record>

    <record id="view_audit_pbc_request_form" model="ir.ui.view">
        <field name="name">audit.pbc.request.form</field>
        <field name="model">audit.pbc.request</field>
        <field name="arch" type="xml">
            <form string="PBC Request">
                <header>
                    <button name="action_request" string="Send Request" type="object" class="btn-primary" attrs="{'invisible': ['|', ('delivery_status', '=', 'requested'), ('delivery_status', '=', 'received')]}"/>
                    <button name="action_mark_received" string="Mark Received" type="object" class="btn-success" attrs="{'invisible': [('delivery_status', '=', 'received')]}"/>
                    <button name="action_send_reminder" string="Send Reminder" type="object" class="btn-secondary"/>
                    <field name="delivery_status" widget="statusbar" statusbar_visible="not_requested,requested,incomplete,received"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="engagement_id"/>
                            <field name="category"/>
                            <field name="responsible_client_contact"/>
                            <field name="shared_with_portal"/>
                        </group>
                        <group>
                            <field name="requested_date"/>
                            <field name="due_date"/>
                            <field name="received_date"/>
                            <field name="reminder_count" readonly="1"/>
                            <field name="escalation_level" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Description">
                            <field name="description" nolabel="1"/>
                        </page>
                        <page string="Attachments">
                            <field name="attachment_ids" widget="many2many_binary"/>
                        </page>
                        <page string="Follow-up Log">
                            <field name="follow_up_log" nolabel="1" widget="html"/>
                        </page>
                        <page string="Reminder History">
                            <field name="reminder_log_ids">
                                <tree editable="bottom">
                                    <field name="reminder_type"/>
                                    <field name="reminder_date"/>
                                    <field name="note"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_audit_pbc_request_kanban" model="ir.ui.view">
        <field name="name">audit.pbc.request.kanban</field>
        <field name="model">audit.pbc.request</field>
        <field name="arch" type="xml">
            <kanban default_group_by="delivery_status">
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_primary_left">
                                <strong t-field="record.name"/>
                                <div class="text-muted" t-field="record.engagement_id"/>
                            </div>
                            <div>
                                <span class="badge" t-att-class="'badge-danger' if record.delivery_status.raw_value == 'incomplete' else ''" t-field="record.due_date"/>
                            </div>
                            <div>
                                <span>Reminders: </span><span t-esc="record.reminder_count.value"/>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="view_audit_pbc_template_tree" model="ir.ui.view">
        <field name="name">audit.pbc.template.tree</field>
        <field name="model">audit.pbc.template</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="entity_classification"/>
                <field name="category"/>
            </tree>
        </field>
    </record>

    <record id="view_audit_pbc_template_form" model="ir.ui.view">
        <field name="name">audit.pbc.template.form</field>
        <field name="model">audit.pbc.template</field>
        <field name="arch" type="xml">
            <form string="PBC Template">
                <sheet>
                    <group>
                        <field name="name"/>
                        <field name="entity_classification"/>
                        <field name="category"/>
                    </group>
                    <field name="description" nolabel="1"/>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_audit_pbc_requests" model="ir.actions.act_window">
        <field name="name">PBC Requests</field>
        <field name="res_model">audit.pbc.request</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{'default_delivery_status': 'not_requested'}</field>
    </record>

    <record id="action_audit_pbc_templates" model="ir.actions.act_window">
        <field name="name">PBC Templates</field>
        <field name="res_model">audit.pbc.template</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="menu_audit_pbc_root" name="PBC" parent="audit_planning_compliance.menu_audit_planning_root" sequence="40"/>
    <menuitem id="menu_audit_pbc_request" name="Requests" parent="menu_audit_pbc_root" action="action_audit_pbc_requests" sequence="10"/>
    <menuitem id="menu_audit_pbc_templates" name="Templates" parent="menu_audit_pbc_root" action="action_audit_pbc_templates" groups="audit_planning_compliance.group_audit_partner" sequence="20"/>
</odoo>
