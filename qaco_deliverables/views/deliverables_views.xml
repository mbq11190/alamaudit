<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Deliverables Form View -->
        <record id="view_deliverables_form" model="ir.ui.view">
            <field name="name">qaco.deliverables.form</field>
            <field name="model">qaco.deliverables</field>
            <field name="arch" type="xml">
                <form string="Audit Deliverables">
                    <header>
                        <button name="action_start_preparation" string="Start Preparation" type="object" 
                                class="oe_highlight" invisible="state != 'draft'"/>
                        <button name="action_submit_for_review" string="Submit for Review" type="object" 
                                class="oe_highlight" invisible="state != 'preparation'"/>
                        <button name="action_mark_ready" string="Mark Ready" type="object" 
                                class="oe_highlight" invisible="state != 'review'"/>
                        <button name="action_deliver" string="Deliver" type="object" 
                                class="oe_highlight" invisible="state != 'ready'"/>
                        <button name="action_acknowledge" string="Mark Acknowledged" type="object" 
                                class="oe_highlight" invisible="state != 'delivered'"/>
                        <button name="action_complete" string="Complete" type="object" 
                                class="oe_highlight" invisible="state != 'acknowledged'"/>
                        <button name="action_reset_to_draft" string="Reset to Draft" type="object" 
                                invisible="state == 'draft'"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,preparation,review,ready,delivered,acknowledged,completed"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="audit_id" options="{'no_create': True}"/>
                                <field name="client_id"/>
                                <field name="finalisation_id" options="{'no_create': True}"/>
                            </group>
                            <group>
                                <field name="deliverables_date"/>
                                <field name="responsible_partner_id"/>
                                <field name="deliverable_count"/>
                            </group>
                        </group>
                        <notebook>
                            <!-- Deliverable Items Tab -->
                            <page string="Deliverable Items">
                                <field name="deliverable_item_ids">
                                    <tree editable="bottom">
                                        <field name="sequence" widget="handle"/>
                                        <field name="name"/>
                                        <field name="deliverable_type"/>
                                        <field name="version"/>
                                        <field name="prepared_by_id"/>
                                        <field name="reviewed_by_id"/>
                                        <field name="state" widget="badge" decoration-success="state == 'approved'" decoration-info="state == 'draft'"/>
                                    </tree>
                                    <form>
                                        <header>
                                            <button name="action_start_progress" string="Start" type="object" 
                                                    class="oe_highlight" invisible="state != 'draft'"/>
                                            <button name="action_submit_for_review" string="Submit for Review" type="object" 
                                                    class="oe_highlight" invisible="state != 'in_progress'"/>
                                            <button name="action_approve" string="Approve" type="object" 
                                                    class="oe_highlight" invisible="state != 'review'"/>
                                            <button name="action_deliver" string="Deliver" type="object" 
                                                    invisible="state != 'approved'"/>
                                            <field name="state" widget="statusbar" statusbar_visible="draft,in_progress,review,approved,delivered"/>
                                        </header>
                                        <sheet>
                                            <group>
                                                <group>
                                                    <field name="name"/>
                                                    <field name="deliverable_type"/>
                                                    <field name="description"/>
                                                </group>
                                                <group>
                                                    <field name="version"/>
                                                    <field name="revision_number"/>
                                                    <field name="copies_required"/>
                                                </group>
                                            </group>
                                            <group>
                                                <group>
                                                    <field name="prepared_by_id"/>
                                                    <field name="preparation_date"/>
                                                </group>
                                                <group>
                                                    <field name="reviewed_by_id"/>
                                                    <field name="review_date"/>
                                                </group>
                                            </group>
                                            <group>
                                                <group>
                                                    <field name="approved_by_id"/>
                                                    <field name="approval_date"/>
                                                </group>
                                            </group>
                                            <group string="Document">
                                                <label for="document"/>
                                                <div class="o_row">
                                                    <field name="document" filename="document_filename"/>
                                                    <field name="document_filename" invisible="1"/>
                                                </div>
                                            </group>
                                            <group>
                                                <field name="distribution_list" placeholder="List recipients..."/>
                                            </group>
                                            <group>
                                                <field name="notes" placeholder="Additional notes..."/>
                                            </group>
                                        </sheet>
                                    </form>
                                </field>
                            </page>

                            <!-- Delivery Information Tab -->
                            <page string="Delivery Information">
                                <group>
                                    <group>
                                        <field name="scheduled_delivery_date"/>
                                        <field name="actual_delivery_date"/>
                                        <field name="delivery_method"/>
                                    </group>
                                    <group>
                                        <field name="delivery_contact_id"/>
                                        <field name="delivery_email"/>
                                        <field name="tracking_number"/>
                                    </group>
                                </group>
                                <group>
                                    <field name="delivery_address" placeholder="Delivery address..."/>
                                </group>
                            </page>

                            <!-- Client Acknowledgment Tab -->
                            <page string="Client Acknowledgment">
                                <group>
                                    <group>
                                        <field name="acknowledgment_required"/>
                                        <field name="acknowledgment_received"/>
                                        <field name="acknowledgment_date"/>
                                        <field name="acknowledged_by"/>
                                    </group>
                                    <group>
                                        <label for="acknowledgment_document"/>
                                        <div class="o_row">
                                            <field name="acknowledgment_document" filename="acknowledgment_filename"/>
                                            <field name="acknowledgment_filename" invisible="1"/>
                                        </div>
                                    </group>
                                </group>
                            </page>

                            <!-- Cover Letter Tab -->
                            <page string="Cover Letter">
                                <group>
                                    <group>
                                        <field name="cover_letter_required"/>
                                        <label for="cover_letter"/>
                                        <div class="o_row">
                                            <field name="cover_letter" filename="cover_letter_filename"/>
                                            <field name="cover_letter_filename" invisible="1"/>
                                        </div>
                                    </group>
                                </group>
                                <group>
                                    <field name="cover_letter_notes" placeholder="Cover letter notes and instructions..."/>
                                </group>
                            </page>

                            <!-- Follow-up Tab -->
                            <page string="Follow-up">
                                <group>
                                    <group>
                                        <field name="follow_up_required"/>
                                        <field name="follow_up_date"/>
                                        <field name="follow_up_completed"/>
                                    </group>
                                </group>
                                <group>
                                    <field name="follow_up_notes" placeholder="Follow-up actions and notes..."/>
                                </group>
                            </page>

                            <!-- Regulatory Filing Tab -->
                            <page string="Regulatory Filing">
                                <group>
                                    <group>
                                        <field name="regulatory_filing_required"/>
                                        <field name="regulatory_body"/>
                                        <field name="filing_deadline"/>
                                    </group>
                                    <group>
                                        <field name="filing_completed"/>
                                        <field name="filing_date"/>
                                        <field name="filing_reference"/>
                                    </group>
                                </group>
                            </page>

                            <!-- Notes Tab -->
                            <page string="Notes">
                                <field name="notes" placeholder="Additional notes and observations..."/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Deliverables Tree View -->
        <record id="view_deliverables_tree" model="ir.ui.view">
            <field name="name">qaco.deliverables.tree</field>
            <field name="model">qaco.deliverables</field>
            <field name="arch" type="xml">
                <tree string="Audit Deliverables">
                    <field name="name"/>
                    <field name="audit_id"/>
                    <field name="client_id"/>
                    <field name="deliverables_date"/>
                    <field name="scheduled_delivery_date"/>
                    <field name="actual_delivery_date"/>
                    <field name="deliverable_count"/>
                    <field name="state" widget="badge" decoration-success="state == 'completed'" decoration-info="state == 'draft'"/>
                </tree>
            </field>
        </record>

        <!-- Deliverables Search View -->
        <record id="view_deliverables_search" model="ir.ui.view">
            <field name="name">qaco.deliverables.search</field>
            <field name="model">qaco.deliverables</field>
            <field name="arch" type="xml">
                <search string="Audit Deliverables">
                    <field name="name"/>
                    <field name="audit_id"/>
                    <field name="client_id"/>
                    <field name="responsible_partner_id"/>
                    <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>
                    <filter string="In Progress" name="in_progress" domain="[('state', 'in', ('preparation', 'review'))]"/>
                    <filter string="Ready" name="ready" domain="[('state', '=', 'ready')]"/>
                    <filter string="Delivered" name="delivered" domain="[('state', 'in', ('delivered', 'acknowledged'))]"/>
                    <filter string="Completed" name="completed" domain="[('state', '=', 'completed')]"/>
                    <separator/>
                    <filter string="Acknowledgment Pending" name="ack_pending" domain="[('acknowledgment_required', '=', True), ('acknowledgment_received', '=', False)]"/>
                    <filter string="Regulatory Filing Pending" name="filing_pending" domain="[('regulatory_filing_required', '=', True), ('filing_completed', '=', False)]"/>
                    <group expand="0" string="Group By">
                        <filter string="Status" name="group_state" context="{'group_by': 'state'}"/>
                        <filter string="Responsible Partner" name="group_partner" context="{'group_by': 'responsible_partner_id'}"/>
                        <filter string="Client" name="group_client" context="{'group_by': 'client_id'}"/>
                        <filter string="Delivery Method" name="group_method" context="{'group_by': 'delivery_method'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Deliverables Action -->
        <record id="action_deliverables" model="ir.actions.act_window">
            <field name="name">Audit Deliverables</field>
            <field name="res_model">qaco.deliverables</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create audit deliverables
                </p>
                <p>
                    Manage audit reports, financial statements, and other deliverables.
                </p>
            </field>
        </record>
    </data>
</odoo>
