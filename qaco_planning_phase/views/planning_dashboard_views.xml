<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ================================================================== -->
    <!-- PLANNING DASHBOARD - Session 5C                                    -->
    <!-- Visual progress tracking for P-1 through P-12 tabs                 -->
    <!-- ================================================================== -->

    <!-- Dashboard Kanban View (Main View) -->
    <record id="view_planning_main_dashboard_kanban" model="ir.ui.view">
        <field name="name">qaco.planning.main.dashboard.kanban</field>
        <field name="model">qaco.planning.main</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" create="false" edit="false">
                <field name="name"/>
                <field name="client_id"/>
                <field name="audit_id"/>
                <field name="overall_progress"/>
                <field name="tabs_not_started"/>
                <field name="tabs_in_progress"/>
                <field name="tabs_completed"/>
                <field name="tabs_reviewed"/>
                <field name="tabs_approved"/>
                <field name="is_planning_complete"/>
                <field name="is_planning_locked"/>
                
                <!-- P-tab states for status badges -->
                <field name="p1_engagement_id"/>
                <field name="p2_entity_id"/>
                <field name="p3_controls_id"/>
                <field name="p4_analytics_id"/>
                <field name="p5_materiality_id"/>
                <field name="p6_risk_id"/>
                <field name="p7_fraud_id"/>
                <field name="p8_going_concern_id"/>
                <field name="p9_laws_id"/>
                <field name="p10_related_parties_id"/>
                <field name="p11_group_audit_id"/>
                <field name="p12_strategy_id"/>
                <field name="p13_approval_id"/>
                
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <!-- Header -->
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="name"/>
                                    </strong>
                                    <div class="o_kanban_record_subtitle text-muted">
                                        <field name="client_id"/> - <field name="audit_id"/>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Overall Progress Bar -->
                            <div class="o_kanban_record_body">
                                <div class="progress mb-2" style="height: 25px;">
                                    <div class="progress-bar bg-success" role="progressbar" 
                                         t-attf-style="width: #{record.overall_progress.value}%;"
                                         t-att-aria-valuenow="record.overall_progress.value"
                                         aria-valuemin="0" aria-valuemax="100">
                                        <strong><t t-esc="Math.round(record.overall_progress.value)"/>%</strong>
                                    </div>
                                </div>
                                
                                <!-- Tab Status Summary -->
                                <div class="row text-center mb-2">
                                    <div class="col-3">
                                        <span class="badge bg-secondary"><i class="fa fa-circle" title="Status: not started" aria-hidden="true"/> <t t-esc="record.tabs_not_started.value"/> Not Started</span>
                                    </div>
                                    <div class="col-3">
                                        <span class="badge bg-primary"><i class="fa fa-play" title="Status: in progress" aria-hidden="true"/> <t t-esc="record.tabs_in_progress.value"/> In Progress</span>
                                    </div>
                                    <div class="col-3">
                                        <span class="badge bg-info"><i class="fa fa-check" title="Status: completed" aria-hidden="true"/> <t t-esc="record.tabs_completed.value"/> Completed</span>
                                    </div>
                                    <div class="col-3">
                                        <span class="badge bg-success"><i class="fa fa-check-circle" title="Status: approved" aria-hidden="true"/> <t t-esc="record.tabs_approved.value"/> Approved</span>
                                    </div>
                                </div>
                                
                                <!-- P-Tab Status Grid (3 rows x 5 columns) -->
                                <table class="table table-sm table-borderless" style="font-size: 11px;">
                                    <tbody>
                                        <!-- Row 1: P-1 to P-5 -->
                                        <tr>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-1</t>
                                                    <t t-set="tab_field">p1_engagement_id</t>
                                                </t>
                                            </td>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-2</t>
                                                    <t t-set="tab_field">p2_entity_id</t>
                                                </t>
                                            </td>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-3</t>
                                                    <t t-set="tab_field">p3_controls_id</t>
                                                </t>
                                            </td>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-4</t>
                                                    <t t-set="tab_field">p4_analytics_id</t>
                                                </t>
                                            </td>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-5</t>
                                                    <t t-set="tab_field">p5_materiality_id</t>
                                                </t>
                                            </td>
                                        </tr>
                                        <!-- Row 2: P-6 to P-10 -->
                                        <tr>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-6</t>
                                                    <t t-set="tab_field">p6_risk_id</t>
                                                </t>
                                            </td>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-7</t>
                                                    <t t-set="tab_field">p7_fraud_id</t>
                                                </t>
                                            </td>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-8</t>
                                                    <t t-set="tab_field">p8_going_concern_id</t>
                                                </t>
                                            </td>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-9</t>
                                                    <t t-set="tab_field">p9_laws_id</t>
                                                </t>
                                            </td>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-10</t>
                                                    <t t-set="tab_field">p10_related_parties_id</t>
                                                </t>
                                        <!-- Row 3: P-11 to P-12 -->
                                        </tr>
                                        <!-- Row 3: P-11 to P-12 -->
                                        <tr>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-11</t>
                                                    <t t-set="tab_field">p11_group_audit_id</t>
                                                </t>
                                            </td>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-12</t>
                                                    <t t-set="tab_field">p12_strategy_id</t>
                                                </t>
                                            </td>
                                            <td class="text-center">
                                                <t t-call="planning_tab_status_badge">
                                                    <t t-set="tab_name">P-12</t>
                                                    <t t-set="tab_field">p13_approval_id</t>
                                                </t>
                                            </td>
                                            <td class="text-center"></td>
                                            <td class="text-center"></td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <!-- Planning Lock Status -->
                                <div class="text-center mt-2">
                                    <span t-if="record.is_planning_locked.raw_value" 
                                          class="badge bg-dark">
                                        <i class="fa fa-lock" title="Planning locked" aria-hidden="true"/> Planning Locked - Execution Phase Active
                                    </span>
                                    <span t-elif="record.is_planning_complete.raw_value" 
                                          class="badge bg-success">
                                        <i class="fa fa-check-circle" title="Planning complete" aria-hidden="true"/> Planning Complete - Ready to Lock
                                    </span>
                                    <span t-else="" class="badge bg-warning text-dark">
                                        <i class="fa fa-hourglass-half" title="In progress" aria-hidden="true"/> Planning In Progress
                                    </span>
                                </div>
                            </div>
                        </div>
                    </t>
                    
                    <!-- Sub-template for P-tab status badges -->
                    <t t-name="planning_tab_status_badge">
                        <t t-set="tab" t-value="record[tab_field]"/>
                        <t t-if="tab and tab.raw_value">
                            <t t-set="state" t-value="record[tab_field + '.state'] and record[tab_field + '.state'].raw_value or 'not_started'"/>
                            <div t-attf-class="badge badge-pill {{
                                state == 'approved' and 'bg-success' or 
                                state == 'reviewed' and 'bg-info' or 
                                state == 'completed' and 'bg-primary' or 
                                state == 'in_progress' and 'bg-warning text-dark' or 
                                'bg-secondary'
                            }}" style="min-width: 50px;">
                                <strong><t t-esc="tab_name"/></strong><br/>
                                <small>
                                    <t t-if="state == 'approved'">‚úì Approved</t>
                                    <t t-elif="state == 'reviewed'">üëÅ Reviewed</t>
                                    <t t-elif="state == 'completed'">‚úì Complete</t>
                                    <t t-elif="state == 'in_progress'">‚è≥ Working</t>
                                    <t t-else="">‚è∏ Not Started</t>
                                </small>
                            </div>
                        </t>
                        <t t-else="">
                            <div class="badge badge-pill bg-secondary" style="min-width: 50px;">
                                <strong><t t-esc="tab_name"/></strong><br/>
                                <small>‚è∏ Not Started</small>
                            </div>
                        </t>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Tree View for Dashboard (Alternative) -->
    <record id="view_planning_main_dashboard_tree" model="ir.ui.view">
        <field name="name">qaco.planning.main.dashboard.tree</field>
        <field name="model">qaco.planning.main</field>
        <field name="arch" type="xml">
            <tree create="false" edit="false" decoration-success="is_planning_complete == True">
                <field name="name"/>
                <field name="client_id"/>
                <field name="audit_id"/>
                <field name="overall_progress" widget="progressbar"/>
                <field name="tabs_approved" string="Approved"/>
                <field name="tabs_reviewed" string="Reviewed"/>
                <field name="tabs_in_progress" string="In Progress"/>
                <field name="tabs_not_started" string="Not Started"/>
                <field name="is_planning_complete" invisible="1"/>
                <field name="is_planning_locked" widget="boolean_toggle"/>
            </tree>
        </field>
    </record>

    <!-- Dashboard Action -->
    <record id="action_planning_dashboard" model="ir.actions.act_window">
        <field name="name">Planning Progress Dashboard</field>
        <field name="res_model">qaco.planning.main</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{'create': False}</field>
        <field name="view_ids" 
               eval="[(5, 0, 0),
                      (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_planning_main_dashboard_kanban')}),
                      (0, 0, {'view_mode': 'tree', 'view_id': ref('view_planning_main_dashboard_tree')})]"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Planning Phases found!
            </p>
            <p>
                Planning dashboards will appear here once audit engagements have planning phases initialized.
            </p>
        </field>
    </record>

</odoo>
