<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<record id="view_qaco_planning_phase_form" model="ir.ui.view">
		<field name="name">qaco.planning.phase.form</field>
		<field name="model">qaco.planning.phase</field>
		<field name="arch" type="xml">
			<form string="Planning Phase - Statutory Audit Pakistan" class="o_planning_form">
				<header>
					<button name="action_manager_sign" type="object" string="Manager Sign-off"
							class="btn-primary oe_highlight"
							modifiers='{"invisible": ["|", ["manager_signed_user_id", "!=", false], ["planning_complete", "=", true]]}'/>
					<button name="action_partner_sign" type="object" string="Partner Sign-off"
							class="btn-secondary"
							modifiers='{"invisible": ["|", ["partner_signed_user_id", "!=", false], ["planning_complete", "=", true]]}'/>
					<button name="action_mark_planning_complete" type="object" string="Complete Planning Phase"
							class="btn-success"
							modifiers='{"invisible": [["planning_complete", "=", true]], "readonly": [["can_finalize_planning", "=", false]]}'/>
					<button name="action_quality_review" type="object" string="Quality Review"
							class="btn-warning"
							modifiers='{"invisible": [["quality_reviewer_id", "!=", false]]}'/>
					<button name="action_generate_planning_memo" type="object" string="Generate Planning Memo"
							class="btn-link"/>
					<field name="planning_complete" widget="boolean_button" options='{"terminology": "close"}' class="oe_right"/>
				</header>
				<sheet>
					<group string="Basic Audit Information" colspan="4">
						<group string="Engagement Details">
							<field name="name" readonly="1" class="oe_inline"/>
							<field name="audit_id" required="1" class="oe_inline"/>
							<field name="client_id" readonly="1" class="oe_inline"/>
						</group>
						<group string="Audit Period">
							<field name="audit_type" required="1"/>
							<field name="audit_period_from" required="1"/>
							<field name="audit_period_to" required="1"/>
							<field name="financial_year_end" required="1"/>
						</group>
						<group string="Previous Auditor">
							<field name="previous_auditor"/>
							<field name="audit_tenure_years" readonly="1"/>
						</group>
					</group>
					<group string="Planning Phase Status Dashboard" colspan="4">
						<label string="Overall Completion Status" for="completion_status" class="o_form_label"/>
						<group>
							<field name="understanding_status" widget="progressbar" options='{"editable": true}'/>
							<field name="analytics_status" widget="progressbar" options='{"editable": true}'/>
							<field name="materiality_status" widget="progressbar" options='{"editable": true}'/>
							<field name="control_status" widget="progressbar" options='{"editable": true}'/>
							<field name="risk_status" widget="progressbar" options='{"editable": true}'/>
							<field name="completion_status" widget="progressbar" options='{"editable": true}'/>
						</group>
					</group>
					<group string="Planning Requirements Status" modifiers='{"invisible": [["can_finalize_planning", "=", true]]}'>
						<field name="missing_requirements_note" nolabel="1" readonly="1"/>
					</group>
					<notebook>
						<page string="Entity &amp; Environment (ISA 315)" modifiers='{"invisible": [["understanding_status", "=", "green"]]}'>
							<group string="Industry &amp; Business Overview" colspan="2">
								<field name="industry_type" required="1"/>
								<field name="industry_id"/>
								<field name="business_model" nolabel="1" placeholder="Describe the business model, revenue sources, key products/services, major customers and suppliers..."/>
							</group>
							<group string="Organizational Structure" colspan="2">
								<field name="organizational_structure" nolabel="1" placeholder="Describe organizational structure, key personnel, reporting lines, governance framework..."/>
							</group>
							<group string="Operational Footprint" colspan="2">
								<field name="operational_locations" nolabel="1" placeholder="List all operational locations, branches, warehouses, and their significance..."/>
							</group>
							<group string="Key Contracts &amp; Arrangements" colspan="2">
								<field name="key_contracts" nolabel="1" placeholder="Document key contractual arrangements: long-term supply contracts, franchises, leases, joint ventures..."/>
							</group>
							<group string="Regulatory Framework - Pakistan" colspan="2">
								<field name="applicable_regulators" widget="many2many_tags" placeholder="Select applicable regulators..."/>
								<field name="regulatory_filings_status"/>
								<field name="regulatory_penalties" nolabel="1" placeholder="Document any regulatory penalties, litigations, or compliance issues..."/>
								<field name="compliance_certificates" nolabel="1" placeholder="Status of compliance certificates, licenses, registrations..."/>
							</group>
							<group string="Related Parties &amp; Group Structure (ISA 550)" colspan="2">
								<field name="related_parties_summary" nolabel="1" placeholder="Identify all related parties, nature of relationships, and control relationships..."/>
								<field name="group_structure" nolabel="1" placeholder="Describe group structure, ownership, and organizational hierarchy..."/>
								<field name="intra_group_transactions" nolabel="1" placeholder="Document intra-group transactions, pricing policies, and significant arrangements..."/>
							</group>
							<group string="Fraud Risk Assessment (ISA 240)" colspan="2">
								<field name="fraud_incentives" nolabel="1" placeholder="Identify incentives/pressures that might predispose management/employees to commit fraud..."/>
								<field name="fraud_opportunities" nolabel="1" placeholder="Identify opportunities for fraud due to control weaknesses or complex transactions..."/>
								<field name="fraud_attitudes" nolabel="1" placeholder="Assess attitudes/rationalizations that might justify fraudulent financial reporting..."/>
								<field name="fraud_risk_assessment" nolabel="1" placeholder="Overall fraud risk assessment and conclusions..."/>
							</group>
						</page>
						<page string="Analytical Procedures (ISA 520)" modifiers='{"invisible": [["analytics_status", "=", "green"]]}'>
							<group string="Financial Data for Analysis" colspan="2">
								<field name="prior_year_fs_attachment_ids" widget="many2many_binary" string="Prior Year Financial Statements (Last 3 Years)"/>
								<field name="current_year_tb_attachment_ids" widget="many2many_binary" string="Current Year Trial Balance &amp; Draft FS"/>
							</group>
							<group string="Industry Benchmarks &amp; Comparisons" colspan="2">
								<field name="industry_benchmarks" nolabel="1" placeholder="Industry benchmarks, competitor analysis, economic indicators relevant to the entity..."/>
							</group>
							<group string="Trend &amp; Ratio Analysis" colspan="2">
								<field name="trend_analysis" nolabel="1" placeholder="3-5 year trend analysis of key financial statement line items..."/>
								<field name="ratio_analysis_summary" nolabel="1" placeholder="Profitability, liquidity, solvency, and efficiency ratio analysis..."/>
								<field name="analytical_expectations" nolabel="1" placeholder="Analytical expectations vs actual results with explanations for variances..."/>
							</group>
							<group string="Significant Fluctuations Analysis" colspan="2">
								<field name="significant_fluctuations" nolabel="1" placeholder="Analysis of significant fluctuations (&gt;10% or materiality) with management inquiries..."/>
							</group>
							<group string="Going Concern Assessment (ISA 570)" colspan="2">
								<field name="going_concern_assessment" nolabel="1" placeholder="Assessment of going concern assumption, indicators of going concern issues..."/>
							</group>
						</page>
						<page string="Materiality (ISA 320)" modifiers='{"invisible": [["materiality_status", "=", "green"]]}'>
							<group string="Materiality Benchmark Selection" colspan="2">
								<field name="materiality_benchmark" required="1"/>
								<field name="materiality_percentage" required="1"/>
								<field name="custom_benchmark_value" modifiers='{"required": [["materiality_benchmark", "=", "custom"]], "invisible": [["materiality_benchmark", "!=", "custom"]]}'/>
							</group>
							<group string="Materiality Justification" colspan="2">
								<field name="materiality_justification" nolabel="1" required="1" placeholder="Justify benchmark selection considering entity circumstances, industry practices, and ISA 320 guidance..."/>
							</group>
							<group string="Calculated Materiality Amounts" colspan="2">
								<field name="overall_materiality" readonly="1"/>
								<field name="performance_materiality" readonly="1"/>
								<field name="clearly_trivial_threshold" readonly="1"/>
							</group>
							<group string="Materiality Documentation" colspan="2">
								<field name="materiality_worksheet_attachment_ids" widget="many2many_binary" string="Materiality Calculation Worksheets &amp; Documentation"/>
							</group>
						</page>
						<page string="Internal Controls (ISA 315)" modifiers='{"invisible": [["control_status", "=", "green"]]}'>
							<group string="Control Environment Assessment" colspan="2">
								<field name="control_environment_rating" required="1" widget="radio"/>
								<field name="entity_level_controls_rating" required="1" widget="radio"/>
								<field name="risk_assessment_rating" required="1" widget="radio"/>
							</group>
							<group string="Control Activities &amp; Monitoring" colspan="2">
								<field name="control_activities_rating" required="1" widget="radio"/>
								<field name="monitoring_controls_rating" required="1" widget="radio"/>
								<field name="itgc_rating" required="1" widget="radio"/>
								<field name="internal_audit_function" widget="radio"/>
							</group>
							<group string="Control Reliance Strategy" colspan="2">
								<field name="reliance_on_controls" readonly="1"/>
								<field name="control_assessment_summary" nolabel="1" placeholder="Overall control assessment summary and conclusions regarding reliance strategy..."/>
							</group>
							<group string="Internal Control Documentation" colspan="2">
								<field name="internal_control_attachment_ids" widget="many2many_binary" string="Control Questionnaires, Walkthrough Documentation, and Assessment Sheets"/>
								<field name="process_flow_attachment_ids" widget="many2many_binary" string="Process Flowcharts for Significant Cycles"/>
							</group>
						</page>
						<page string="Risk &amp; Strategy (ISA 315, 330)" modifiers='{"invisible": [["risk_status", "=", "green"]]}'>
							<group string="Risk Register" colspan="2">
								<field name="risk_register_line_ids" nolabel="1" context="{'default_planning_phase_id': active_id}">
									<tree editable="bottom" default_order="sequence">
										<field name="sequence" widget="handle"/>
										<field name="account_cycle"/>
										<field name="risk_description"/>
										<field name="risk_rating" widget="selection_badge"/>
										<field name="is_significant_risk"/>
										<field name="fs_level_risk"/>
										<field name="assertion_type"/>
									</tree>
									<form>
										<group>
											<group string="Risk Identification">
												<field name="account_cycle"/>
												<field name="risk_description"/>
												<field name="fs_level_risk"/>
												<field name="assertion_type"/>
											</group>
											<group string="Risk Assessment">
												<field name="risk_rating"/>
												<field name="is_significant_risk"/>
												<field name="likelihood"/>
												<field name="magnitude"/>
											</group>
										</group>
										<group string="ISA Risk Classification">
											<field name="isa_240_risk"/>
											<field name="isa_540_risk"/>
											<field name="isa_550_risk"/>
											<field name="isa_570_risk"/>
										</group>
										<group string="Root Cause &amp; Impact">
											<field name="root_cause"/>
											<field name="impact_on_fs"/>
										</group>
										<group string="Audit Response">
											<field name="planned_procedures"/>
											<field name="nature_of_procedures"/>
											<field name="timing_of_procedures"/>
											<field name="extent_of_procedures"/>
											<field name="link_to_audit_program"/>
										</group>
									</form>
								</field>
							</group>
							<group string="Overall Audit Strategy" colspan="2">
								<field name="audit_approach" nolabel="1" required="1" placeholder="Describe overall audit approach, nature/timing/extent of procedures, reliance strategy..."/>
							</group>
							<group string="Specialized Resources" colspan="2">
								<field name="use_of_experts"/>
								<field name="experts_details" nolabel="1" modifiers='{"invisible": [["use_of_experts", "=", false]]}' placeholder="Scope of expert work, qualifications, coordination procedures..."/>
								<field name="use_of_caats"/>
								<field name="caats_details" nolabel="1" modifiers='{"invisible": [["use_of_caats", "=", false]]}' placeholder="CAATs tools, data analytics approach, specific procedures..."/>
								<field name="component_auditors_involved"/>
								<field name="component_auditors_details" nolabel="1" modifiers='{"invisible": [["component_auditors_involved", "=", false]]}' placeholder="Component auditor coordination, instructions, review procedures..."/>
							</group>
							<group string="Staffing &amp; Timeline" colspan="2">
								<field name="staffing_plan" nolabel="1" placeholder="Staffing plan, team composition, experience levels, supervision arrangements..."/>
								<field name="audit_timeline" nolabel="1" placeholder="Detailed audit timeline, key milestones, interim and final procedures..."/>
								<field name="budget_hours" string="Planned Budget (Hours)"/>
							</group>
							<group string="Risk &amp; Strategy Documentation" colspan="2">
								<field name="risk_register_attachment_ids" widget="many2many_binary" string="Risk Register Files"/>
								<field name="audit_strategy_attachment_ids" widget="many2many_binary" string="Audit Strategy Documentation"/>
							</group>
						</page>
						<page string="Documentation &amp; Completion (ISA 300)">
							<group string="Planning Memorandum" colspan="2">
								<field name="planning_memo_summary" nolabel="1" placeholder="Executive summary of planning memorandum for partner review..."/>
							</group>
							<group string="Regulatory Compliance - Pakistan" colspan="2">
								<field name="icap_compliance_check" string="ICAP Standards Compliance Verified"/>
								<field name="secp_requirements_met" string="SECP Requirements Addressed"/>
								<field name="aob_guidelines_considered" string="AOB Guidelines Considered"/>
							</group>
							<group string="Mandatory Attachments - Zero Deficiency" colspan="2">
								<label string="The following attachments are mandatory for ICAP/AOB compliance:" class="o_form_label"/>
								<field name="organogram_attachment_ids" widget="many2many_binary" string="Organogram"/>
								<field name="engagement_letter_attachment_ids" widget="many2many_binary" string="Engagement Letter"/>
								<field name="board_minutes_attachment_ids" widget="many2many_binary" string="BOD/Audit Committee Minutes"/>
								<field name="related_party_attachment_ids" widget="many2many_binary" string="Related Party Schedules"/>
								<field name="analytical_summary_attachment_ids" widget="many2many_binary" string="Analytical Summary"/>
								<field name="legal_compliance_attachment_ids" widget="many2many_binary" string="Legal &amp; Compliance Docs"/>
								<field name="previous_audit_reports_attachment_ids" widget="many2many_binary" string="Previous Audit Reports"/>
							</group>
							<group string="Master Checklist - Zero Deficiency Target" colspan="4">
								<label string="Complete ALL checklist items for zero deficiency compliance:" class="o_form_label"/>
								<group col="4">
									<field name="checklist_engagement_letter" readonly="1"/>
									<field name="checklist_entity_understanding" readonly="1"/>
									<field name="checklist_fraud_brainstormed" readonly="1"/>
									<field name="checklist_analytics_performed" readonly="1"/>
								</group>
								<group col="4">
									<field name="checklist_materiality_finalized" readonly="1"/>
									<field name="checklist_controls_assessed" readonly="1"/>
									<field name="checklist_risks_linked" readonly="1"/>
									<field name="checklist_strategy_signed" readonly="1"/>
								</group>
								<group col="4">
									<field name="checklist_independence_confirmed" readonly="1"/>
									<field name="checklist_partner_manager_review" readonly="1"/>
									<field name="checklist_icap_standards" readonly="1"/>
									<field name="checklist_secp_requirements" readonly="1"/>
								</group>
								<group col="4">
									<field name="checklist_aob_guidelines" readonly="1"/>
								</group>
							</group>
							<group string="Sign-offs &amp; Approvals" colspan="2">
								<group string="Manager Sign-off">
									<field name="manager_signed_user_id" readonly="1"/>
									<field name="manager_signed_on" readonly="1"/>
								</group>
								<group string="Partner Sign-off">
									<field name="partner_signed_user_id" readonly="1"/>
									<field name="partner_signed_on" readonly="1"/>
								</group>
								<group string="Quality Review">
									<field name="quality_reviewer_id" readonly="1"/>
									<field name="quality_reviewed_on" readonly="1"/>
								</group>
							</group>
						</page>
					</notebook>
				</sheet>
				<div class="oe_chatter">
					<field name="message_follower_ids" widget="mail_followers"/>
					<field name="activity_ids" widget="mail_activity"/>
					<field name="message_ids" widget="mail_thread"/>
				</div>
			</form>
		</field>
	</record>

	<record id="view_qaco_planning_phase_tree" model="ir.ui.view">
		<field name="name">qaco.planning.phase.tree</field>
		<field name="model">qaco.planning.phase</field>
		<field name="arch" type="xml">
			<tree string="Planning Phases" decoration-success="planning_complete == True" decoration-warning="can_finalize_planning == True">
				<field name="name"/>
				<field name="client_id"/>
				<field name="audit_type"/>
				<field name="audit_period_from"/>
				<field name="audit_period_to"/>
				<field name="understanding_status" widget="progressbar"/>
				<field name="risk_status" widget="progressbar"/>
				<field name="planning_complete" widget="boolean_button"/>
				<field name="can_finalize_planning" invisible="1"/>
				<field name="manager_signed_user_id"/>
				<field name="partner_signed_user_id"/>
			</tree>
		</field>
	</record>

	<record id="view_qaco_planning_phase_search" model="ir.ui.view">
		<field name="name">qaco.planning.phase.search</field>
		<field name="model">qaco.planning.phase</field>
		<field name="arch" type="xml">
			<search string="Search Planning Phases">
				<field name="name"/>
				<field name="client_id"/>
				<field name="audit_type"/>
				<field name="planning_complete"/>
				<filter string="Completed Planning" name="completed" domain="[('planning_complete', '=', True)]"/>
				<filter string="Pending Manager Sign-off" name="pending_manager" domain="[('manager_signed_user_id', '=', False)]"/>
				<filter string="Pending Partner Sign-off" name="pending_partner" domain="[('partner_signed_user_id', '=', False)]"/>
				<filter string="Overdue" name="overdue" domain="[('audit_period_to', '&lt;', context_today())]"/>
				<group expand="0" string="Group By">
					<filter string="Client" name="group_client" context="{'group_by': 'client_id'}"/>
					<filter string="Audit Type" name="group_audit_type" context="{'group_by': 'audit_type'}"/>
					<filter string="Planning Status" name="group_planning_status" context="{'group_by': 'planning_complete'}"/>
				</group>
			</search>
		</field>
	</record>
</odoo>
