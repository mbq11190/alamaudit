<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- P-12: Audit Strategy & Plan - Simplified View -->
    <record id="view_planning_p12_strategy_form" model="ir.ui.view">
        <field name="name">qaco.planning.p12.strategy.form</field>
        <field name="model">qaco.planning.p12.strategy</field>
        <field name="arch" type="xml">
            <form string="P-12: Audit Strategy">
                <header>
                    <field name="state" widget="statusbar" statusbar_visible="draft,review,partner,locked"/>
                    <button name="action_mark_complete" string="Mark Complete" type="object" class="btn-primary"
                            invisible="state != 'draft'"/>
                    <button name="action_manager_review" string="Manager Review" type="object" class="btn-warning"
                            invisible="state != 'draft'" groups="qaco_audit.group_audit_manager"/>
                    <button name="action_partner_approve" string="Partner Approve" type="object" class="btn-success"
                            invisible="state != 'review'" groups="qaco_audit.group_audit_partner"/>
                    <button name="action_send_back" string="Send Back" type="object" class="btn-secondary"
                            invisible="state not in ['review', 'partner']"/>
                    <button name="action_partner_unlock" string="Unlock" type="object" class="btn-danger"
                            invisible="state != 'locked'" groups="qaco_audit.group_audit_partner"/>
                </header>
                <sheet>
                    <field name="can_open" invisible="1"/>
                    <field name="locked" invisible="1"/>
                    
                    <div class="oe_title">
                        <h1><field name="name" readonly="1"/></h1>
                        <h3 class="text-muted">ISA 300 | Audit Strategy &amp; Plan</h3>
                    </div>
                    
                    <group>
                        <group string="Audit Information">
                            <field name="audit_id"/>
                            <field name="client_id" readonly="1"/>
                            <field name="partner_id"/>
                        </group>
                        <group string="Approach">
                            <field name="audit_approach"/>
                            <field name="interim_audit_planned"/>
                            <field name="specialists_required"/>
                            <field name="group_audit_applicable"/>
                        </group>
                    </group>

                    <notebook>
                        <!-- Tab 1: Strategy Overview -->
                        <page string="Strategy" name="strategy">
                            <group string="Audit Approach">
                                <field name="approach_rationale" widget="html"/>
                                <field name="interim_audit_details" widget="html" invisible="not interim_audit_planned"/>
                            </group>
                            <group string="Specialist Requirements" invisible="not specialists_required">
                                <field name="specialist_details" widget="html"/>
                            </group>
                            <group string="Group Audit Strategy" invisible="not group_audit_applicable">
                                <field name="group_audit_strategy" widget="html"/>
                            </group>
                        </page>

                        <!-- Tab 2: Risk Responses -->
                        <page string="Risk Responses" name="risks">
                            <group>
                                <field name="total_risks" readonly="1"/>
                                <field name="risks_with_responses" readonly="1"/>
                                <field name="unaddressed_risks" readonly="1"/>
                                <field name="significant_risk_count" readonly="1"/>
                                <field name="rmm_alignment_confirmed"/>
                            </group>
                        </page>

                        <!-- Tab 3: Procedures -->
                        <page string="Procedures" name="procedures">
                            <group string="Analytical Procedures">
                                <field name="analytical_procedures_planned" widget="html"/>
                            </group>
                            <group string="Fraud Response (ISA 240)">
                                <field name="unpredictable_procedures_planned"/>
                                <field name="unpredictable_procedures_details" widget="html" invisible="not unpredictable_procedures_planned"/>
                                <field name="journal_entry_testing_approach" widget="html"/>
                                <field name="management_override_procedures" widget="html"/>
                            </group>
                        </page>

                        <!-- Tab 4: Budget & Timeline -->
                        <page string="Budget &amp; Timeline" name="budget">
                            <group string="Planned Hours">
                                <group>
                                    <field name="planned_hours_partner"/>
                                    <field name="planned_hours_manager"/>
                                </group>
                                <group>
                                    <field name="planned_hours_senior"/>
                                    <field name="planned_hours_trainee"/>
                                </group>
                                <group>
                                    <field name="total_planned_hours" readonly="1"/>
                                </group>
                            </group>
                            <group string="Key Dates">
                                <group>
                                    <field name="planning_completion_date"/>
                                    <field name="interim_audit_date" invisible="not interim_audit_planned"/>
                                    <field name="fieldwork_start_date"/>
                                </group>
                                <group>
                                    <field name="fieldwork_end_date"/>
                                    <field name="draft_report_date"/>
                                    <field name="final_report_date"/>
                                </group>
                            </group>
                            <group string="Quality Control">
                                <field name="eqcr_required"/>
                                <field name="eqcr_reviewer_id" invisible="not eqcr_required"/>
                            </group>
                        </page>

                        <!-- Tab 5: Attachments -->
                        <page string="Attachments" name="attachments">
                            <group string="Strategy Documentation">
                                <field name="audit_strategy_memo_attachments" widget="many2many_binary" nolabel="1"/>
                            </group>
                            <group string="Audit Programs">
                                <field name="audit_programs_export_attachments" widget="many2many_binary" nolabel="1"/>
                            </group>
                        </page>

                        <!-- Tab 6: Conclusion -->
                        <page string="Conclusion" name="conclusion">
                            <group string="P-12 Conclusion">
                                <field name="conclusion_narrative" widget="html"/>
                            </group>
                            <group string="Confirmations">
                                <field name="all_risks_addressed"/>
                                <field name="programs_finalized_confirmed"/>
                                <field name="strategy_approved_before_execution"/>
                            </group>
                        </page>

                        <!-- Tab 7: Review & Approval -->
                        <page string="Review &amp; Approval" name="approval">
                            <group>
                                <group string="Preparation">
                                    <field name="prepared_by" readonly="1"/>
                                    <field name="prepared_by_role" readonly="1"/>
                                    <field name="prepared_on" readonly="1"/>
                                </group>
                                <group string="Manager Review">
                                    <field name="reviewed_by" readonly="1"/>
                                    <field name="reviewed_on" readonly="1"/>
                                    <field name="review_notes" widget="html"/>
                                </group>
                            </group>
                            <group>
                                <group string="Partner Approval">
                                    <field name="partner_approved" readonly="1"/>
                                    <field name="partner_approved_by" readonly="1"/>
                                    <field name="partner_approved_on" readonly="1"/>
                                    <field name="partner_comments" widget="html"/>
                                </group>
                                <group string="ISA Reference">
                                    <field name="isa_reference"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- P-12 Tree View -->
    <record id="view_planning_p12_strategy_tree" model="ir.ui.view">
        <field name="name">qaco.planning.p12.strategy.tree</field>
        <field name="model">qaco.planning.p12.strategy</field>
        <field name="arch" type="xml">
            <tree string="P-12: Audit Strategy">
                <field name="name"/>
                <field name="audit_id"/>
                <field name="client_id"/>
                <field name="state" widget="badge" decoration-info="state == 'draft'"
                       decoration-warning="state == 'review'" decoration-success="state == 'locked'"/>
            </tree>
        </field>
    </record>

    <!-- P-12 Action -->
    <record id="action_planning_p12_strategy" model="ir.actions.act_window">
        <field name="name">P-12: Audit Strategy</field>
        <field name="res_model">qaco.planning.p12.strategy</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create P-12 Audit Strategy
            </p>
            <p>
                Document overall audit strategy per ISA 300.
            </p>
        </field>
    </record>

</odoo>
                            </group>
                            <group string="Controls to be Tested">
                                <field name="controls_to_test" widget="html" nolabel="1"/>
                            </group>
                            <group string="Control Testing Approach">
                                <field name="control_testing_approach" widget="html" nolabel="1"/>
                            </group>
                        </page>

                        <!-- Tab 4: Substantive Approach -->
                        <page string="Substantive Approach" name="substantive">
                            <group string="Substantive Procedures Overview">
                                <field name="substantive_overview" widget="html" nolabel="1"/>
                            </group>
                            <group string="Tests of Details">
                                <field name="tests_of_details" widget="html" nolabel="1"/>
                            </group>
                            <group string="Substantive Analytical Procedures">
                                <field name="substantive_analytics" widget="html" nolabel="1"/>
                            </group>
                        </page>

                        <!-- Tab 5: Sampling Approach -->
                        <page string="Sampling" name="sampling">
                            <group string="Sampling Methodology">
                                <group>
                                    <field name="sampling_methodology"/>
                                </group>
                                <field name="sampling_approach" widget="html" nolabel="1"/>
                            </group>
                            <group string="Sample Size Determination">
                                <field name="sample_size_determination" widget="html" nolabel="1"/>
                            </group>
                            <group string="Sampling Risk Assessment">
                                <field name="sampling_risk" widget="html" nolabel="1"/>
                            </group>
                        </page>

                        <!-- Tab 6: Use of Experts -->
                        <page string="Experts" name="experts">
                            <group string="Need for Experts">
                                <group>
                                    <field name="expert_required"/>
                                </group>
                            </group>
                            <div invisible="not expert_required">
                                <group string="Expert Register">
                                    <field name="expert_ids" nolabel="1">
                                        <tree editable="bottom">
                                            <field name="expert_name"/>
                                            <field name="expertise_area"/>
                                            <field name="engagement_scope"/>
                                            <field name="competence_assessment"/>
                                            <field name="objectivity_assessment"/>
                                        </tree>
                                    </field>
                                </group>
                                <group string="Expert Work Evaluation">
                                    <field name="expert_work_evaluation" widget="html" nolabel="1"/>
                                </group>
                            </div>
                            <group string="Internal Audit Reliance" invisible="expert_required">
                                <field name="internal_audit_reliance" widget="html"/>
                            </group>
                        </page>

                        <!-- Tab 7: Timing & Resources -->
                        <page string="Timing &amp; Resources" name="timing">
                            <group string="Audit Timeline">
                                <group>
                                    <field name="interim_start_date"/>
                                    <field name="interim_end_date"/>
                                    <field name="final_start_date"/>
                                    <field name="final_end_date"/>
                                </group>
                                <group>
                                    <field name="report_due_date"/>
                                    <field name="agm_date"/>
                                </group>
                            </group>
                            <group string="Resource Allocation">
                                <field name="resource_allocation" widget="html" nolabel="1"/>
                            </group>
                            <group string="Budget Summary">
                                <group>
                                    <field name="total_budgeted_hours"/>
                                    <field name="partner_hours"/>
                                    <field name="manager_hours"/>
                                    <field name="senior_hours"/>
                                    <field name="staff_hours"/>
                                </group>
                            </group>
                        </page>

                        <!-- Tab 8: Direction, Supervision, Review -->
                        <page string="Direction &amp; Supervision" name="supervision">
                            <group string="Direction to Team">
                                <field name="team_direction" widget="html" nolabel="1"/>
                            </group>
                            <group string="Supervision Approach">
                                <field name="supervision_approach" widget="html" nolabel="1"/>
                            </group>
                            <group string="Review Approach">
                                <field name="review_approach" widget="html" nolabel="1"/>
                            </group>
                        </page>

                        <!-- Tab 9: Communication Plan -->
                        <page string="Communication" name="communication">
                            <group string="Communication with TCWG">
                                <field name="tcwg_communication_plan" widget="html" nolabel="1"/>
                            </group>
                            <group string="Communication with Management">
                                <field name="management_communication_plan" widget="html" nolabel="1"/>
                            </group>
                            <group string="Team Communication">
                                <field name="team_communication" widget="html" nolabel="1"/>
                            </group>
                        </page>

                        <!-- Tab 10: Attachments -->
                        <page string="Attachments" name="attachments">
                            <group string="Audit Strategy Document">
                                <field name="strategy_attachment_ids" widget="many2many_binary" nolabel="1"/>
                            </group>
                            <group string="Audit Programs">
                                <field name="program_attachment_ids" widget="many2many_binary" nolabel="1"/>
                            </group>
                        </page>

                        <!-- Tab 11: Conclusion & Sign-off -->
                        <page string="Conclusion &amp; Sign-off" name="conclusion">
                            <group string="Audit Plan Summary">
                                <field name="audit_plan_summary" widget="html" nolabel="1"/>
                            </group>
                            <group>
                                <group string="Summary">
                                    <field name="overall_audit_approach" readonly="1"/>
                                    <field name="control_reliance_approach" readonly="1"/>
                                    <field name="total_budgeted_hours" readonly="1"/>
                                </group>
                            </group>
                            <group>
                                <group string="Sign-off">
                                    <field name="senior_signed_user_id"/>
                                    <field name="senior_signed_on"/>
                                    <field name="manager_reviewed_user_id"/>
                                    <field name="manager_reviewed_on"/>
                                    <field name="partner_approved_user_id"/>
                                    <field name="partner_approved_on"/>
                                </group>
                                <group string="ISA Reference">
                                    <field name="isa_reference"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- P-12 Tree View -->
    <record id="view_planning_p12_strategy_tree" model="ir.ui.view">
        <field name="name">qaco.planning.p12.strategy.tree</field>
        <field name="model">qaco.planning.p12.strategy</field>
        <field name="arch" type="xml">
            <tree string="P-12: Audit Strategy">
                <field name="name"/>
                <field name="client_id"/>
                <field name="overall_audit_approach"/>
                <field name="control_reliance_approach"/>
                <field name="total_budgeted_hours"/>
                <field name="state" widget="badge" decoration-info="state == 'not_started'"
                       decoration-warning="state == 'in_progress'" decoration-success="state == 'approved'"/>
            </tree>
        </field>
    </record>

    <!-- P-12 Action -->
    <record id="action_planning_p12_strategy" model="ir.actions.act_window">
        <field name="name">P-12: Audit Team, Budget &amp; Timeline</field>
        <field name="res_model">qaco.planning.p12.strategy</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create P-12 Audit Team, Budget &amp; Timeline
            </p>
            <p>
                Document audit team allocation, budget and timeline per ISA 300.
            </p>
        </field>
    </record>

    <!-- Key Area Line Tree View -->
    <record id="view_key_area_line_tree" model="ir.ui.view">
        <field name="name">qaco.planning.p12.key.area.line.tree</field>
        <field name="model">qaco.planning.p12.key.area.line</field>
        <field name="arch" type="xml">
            <tree string="Key Audit Areas" editable="bottom">
                <field name="area_name"/>
                <field name="risk_level"/>
                <field name="assertion_focus"/>
                <field name="audit_approach"/>
                <field name="timing"/>
                <field name="assigned_to"/>
                <field name="budgeted_hours"/>
            </tree>
        </field>
    </record>

    <!-- Expert Line Tree View -->
    <record id="view_expert_line_tree" model="ir.ui.view">
        <field name="name">qaco.planning.p12.expert.line.tree</field>
        <field name="model">qaco.planning.p12.expert.line</field>
        <field name="arch" type="xml">
            <tree string="Experts" editable="bottom">
                <field name="expert_name"/>
                <field name="expertise_area"/>
                <field name="engagement_scope"/>
                <field name="competence_assessment"/>
                <field name="objectivity_assessment"/>
            </tree>
        </field>
    </record>

</odoo>
