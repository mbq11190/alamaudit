<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ═══════════════════════════════════════════════════════════════════════
         Embedded Form Views for Planning Tabs P-7 through P-13
         ═══════════════════════════════════════════════════════════════════════ -->
    
    <!-- P-7: Fraud Risk Embedded View -->
    <record id="view_planning_p7_fraud_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p7.fraud.form.embedded</field>
        <field name="model">audit.planning.p7.fraud</field>
        <field name="arch" type="xml">
            <form string="P-7: Fraud Risk Assessment">
                <group string="Fraud Risk Factors (ISA 240)">
                    <field name="fraud_incentives" nolabel="1"
                           placeholder="Incentives/Pressures: Conditions creating incentive to commit fraud..."/>
                    <field name="fraud_opportunities" nolabel="1"
                           placeholder="Opportunities: Circumstances providing opportunity for fraud..."/>
                    <field name="fraud_attitudes" nolabel="1"
                           placeholder="Attitudes/Rationalizations: Attitudes that may justify fraudulent behavior..."/>
                </group>
                <group string="Team Discussion on Fraud Susceptibility">
                    <group>
                        <field name="fraud_discussion_date"/>
                        <field name="fraud_discussion_participants" widget="many2many_tags"/>
                    </group>
                    <field name="fraud_discussion_summary" nolabel="1"
                           placeholder="Summary of team brainstorming on fraud susceptibility..."/>
                </group>
                <group string="Presumed Risks (ISA 240)">
                    <group>
                        <field name="revenue_recognition_risk" readonly="1"/>
                        <field name="revenue_recognition_rebutted"/>
                    </group>
                    <field name="revenue_rebuttal_justification" nolabel="1"
                           invisible="not revenue_recognition_rebutted"/>
                    <group>
                        <field name="management_override_risk" readonly="1"/>
                        <span class="text-muted">Cannot be rebutted - always a significant risk</span>
                    </group>
                </group>
                <group string="Identified Fraud Risks">
                    <field name="fraud_risk_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="sequence" widget="handle"/>
                            <field name="name"/>
                            <field name="fraud_type"/>
                            <field name="affected_account"/>
                            <field name="risk_level"/>
                            <field name="is_significant"/>
                            <field name="planned_response"/>
                        </tree>
                    </field>
                </group>
                <group string="Fraud Risk Responses">
                    <field name="fraud_responses" nolabel="1"
                           placeholder="Planned responses to assessed fraud risks..."/>
                    <field name="journal_entry_testing_plan" nolabel="1"
                           placeholder="ISA 240: Mandatory testing of journal entries..."/>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                        <button name="action_mark_prepared" type="object" string="Mark Prepared" class="btn-primary"/>
                        <button name="action_mark_reviewed" type="object" string="Mark Reviewed" class="btn-success"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
    <!-- P-8: Going Concern Embedded View -->
    <record id="view_planning_p8_going_concern_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p8.going_concern.form.embedded</field>
        <field name="model">audit.planning.p8.going_concern</field>
        <field name="arch" type="xml">
            <form string="P-8: Going Concern">
                <group string="Initial Assessment (ISA 570)">
                    <field name="going_concern_indicators" nolabel="1"
                           placeholder="Overview of going concern indicators..."/>
                </group>
                <group string="Financial Indicators">
                    <group>
                        <field name="financial_indicator_present"/>
                    </group>
                    <field name="financial_indicators" nolabel="1"
                           placeholder="Net liability position, negative operating cash flows, etc."/>
                </group>
                <group string="Operating Indicators">
                    <group>
                        <field name="operating_indicator_present"/>
                    </group>
                    <field name="operating_indicators" nolabel="1"
                           placeholder="Loss of key management, labor difficulties, key customer loss, etc."/>
                </group>
                <group string="Other Indicators">
                    <group>
                        <field name="other_indicator_present"/>
                    </group>
                    <field name="other_indicators" nolabel="1"
                           placeholder="Non-compliance with capital requirements, pending litigation, etc."/>
                </group>
                <group string="Management's Assessment">
                    <group>
                        <field name="management_assessment_obtained"/>
                        <field name="management_assessment_period"/>
                    </group>
                    <field name="management_assessment_review" nolabel="1"/>
                </group>
                <group string="Preliminary Conclusion">
                    <group>
                        <field name="preliminary_conclusion" widget="radio"/>
                    </group>
                    <field name="conclusion_notes" nolabel="1"/>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                        <button name="action_mark_prepared" type="object" string="Mark Prepared" class="btn-primary"/>
                        <button name="action_mark_reviewed" type="object" string="Mark Reviewed" class="btn-success"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
    <!-- P-9: Compliance Embedded View -->
    <record id="view_planning_p9_compliance_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p9.compliance.form.embedded</field>
        <field name="model">audit.planning.p9.compliance</field>
        <field name="arch" type="xml">
            <form string="P-9: Laws &amp; Regulations">
                <group string="Laws with Direct Effect on FS (ISA 250)">
                    <field name="direct_effect_laws" nolabel="1"
                           placeholder="Laws directly affecting financial statement amounts..."/>
                </group>
                <group string="Other Applicable Laws">
                    <field name="other_laws" nolabel="1"
                           placeholder="Laws that may affect operations but not directly FS amounts..."/>
                </group>
                <group string="Pakistan-Specific Compliance">
                    <field name="companies_act_compliance" nolabel="1"
                           placeholder="Companies Act 2017 compliance considerations..."/>
                    <field name="income_tax_ordinance" nolabel="1"
                           placeholder="Income Tax Ordinance 2001 considerations..."/>
                    <field name="sales_tax_act" nolabel="1"
                           placeholder="Sales Tax Act 1990 considerations..."/>
                    <field name="secp_regulations" nolabel="1"
                           placeholder="SECP Regulations considerations..."/>
                    <field name="sbp_regulations" nolabel="1"
                           placeholder="SBP Regulations (if applicable)..."/>
                </group>
                <group string="Industry-Specific">
                    <field name="industry_specific_laws" nolabel="1"/>
                </group>
                <group string="Identified Non-Compliance">
                    <field name="non_compliance_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="law_regulation"/>
                            <field name="nature_of_noncompliance"/>
                            <field name="potential_impact"/>
                            <field name="management_response"/>
                            <field name="audit_response"/>
                        </tree>
                    </field>
                </group>
                <group string="Planned Procedures">
                    <field name="planned_procedures" nolabel="1"/>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                        <button name="action_mark_prepared" type="object" string="Mark Prepared" class="btn-primary"/>
                        <button name="action_mark_reviewed" type="object" string="Mark Reviewed" class="btn-success"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
    <!-- P-10: Related Parties Embedded View -->
    <record id="view_planning_p10_related_party_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p10.related_party.form.embedded</field>
        <field name="model">audit.planning.p10.related_party</field>
        <field name="arch" type="xml">
            <form string="P-10: Related Parties">
                <group string="Understanding (ISA 550)">
                    <field name="related_party_understanding" nolabel="1"
                           placeholder="Nature and business rationale of RP relationships..."/>
                </group>
                <group string="Identified Related Parties">
                    <field name="related_party_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="name"/>
                            <field name="relationship"/>
                            <field name="nature_of_transactions"/>
                            <field name="balance_outstanding"/>
                            <field name="transactions_volume"/>
                        </tree>
                    </field>
                </group>
                <group string="Significant Transactions">
                    <field name="significant_transactions" nolabel="1"
                           placeholder="Transactions outside normal course of business..."/>
                </group>
                <group string="Risk Assessment">
                    <group>
                        <field name="rp_risk_level" widget="radio"/>
                    </group>
                    <field name="rp_risk_assessment" nolabel="1"/>
                </group>
                <group string="Fraud Consideration (ISA 550/240)">
                    <field name="rp_fraud_consideration" nolabel="1"
                           placeholder="Fraud risk related to RP transactions..."/>
                </group>
                <group string="Planned Procedures">
                    <field name="planned_procedures" nolabel="1"/>
                </group>
                <group string="Attachments">
                    <field name="rp_schedule_ids" widget="many2many_binary"/>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                        <button name="action_mark_prepared" type="object" string="Mark Prepared" class="btn-primary"/>
                        <button name="action_mark_reviewed" type="object" string="Mark Reviewed" class="btn-success"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
    <!-- P-11: Group Audit Embedded View -->
    <record id="view_planning_p11_group_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p11.group.form.embedded</field>
        <field name="model">audit.planning.p11.group</field>
        <field name="arch" type="xml">
            <form string="P-11: Group Audit">
                <group string="Applicability (ISA 600)">
                    <group>
                        <field name="is_group_audit"/>
                    </group>
                    <field name="not_applicable_reason" nolabel="1"
                           invisible="is_group_audit"
                           placeholder="Explain why group audit is not applicable..."/>
                </group>
                <group string="Group Structure" invisible="not is_group_audit">
                    <field name="group_structure" nolabel="1"
                           placeholder="Description of group structure and components..."/>
                </group>
                <group string="Components" invisible="not is_group_audit">
                    <field name="component_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="name"/>
                            <field name="significance"/>
                            <field name="component_auditor"/>
                            <field name="work_to_perform"/>
                            <field name="materiality"/>
                        </tree>
                    </field>
                </group>
                <group string="Component Auditors" invisible="not is_group_audit">
                    <group>
                        <field name="component_auditors_involved"/>
                    </group>
                    <field name="component_auditor_assessment" nolabel="1"
                           invisible="not component_auditors_involved"/>
                </group>
                <group string="Group Materiality" invisible="not is_group_audit">
                    <group>
                        <field name="group_materiality"/>
                    </group>
                    <field name="component_materiality" nolabel="1"/>
                </group>
                <group string="Instructions &amp; Consolidation" invisible="not is_group_audit">
                    <field name="group_instructions" nolabel="1"
                           placeholder="Instructions to be issued to component auditors..."/>
                    <field name="consolidation_procedures" nolabel="1"
                           placeholder="Consolidation procedures..."/>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                        <button name="action_mark_prepared" type="object" string="Mark Prepared" class="btn-primary"/>
                        <button name="action_mark_reviewed" type="object" string="Mark Reviewed" class="btn-success"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
    <!-- P-12: Audit Strategy Embedded View -->
    <record id="view_planning_p12_strategy_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p12.strategy.form.embedded</field>
        <field name="model">audit.planning.p12.strategy</field>
        <field name="arch" type="xml">
            <form string="P-12: Audit Strategy">
                <group string="Overall Audit Strategy (ISA 300)">
                    <field name="audit_strategy_summary" nolabel="1"
                           placeholder="Summary of overall audit strategy..."/>
                </group>
                <group string="Scope &amp; Timing">
                    <field name="audit_scope" nolabel="1"
                           placeholder="Scope of the audit, reporting framework, locations..."/>
                    <group>
                        <field name="interim_procedures_date"/>
                        <field name="year_end_procedures_date"/>
                        <field name="report_deadline"/>
                    </group>
                    <field name="audit_timing" nolabel="1"
                           placeholder="Key dates, interim procedures, year-end procedures..."/>
                </group>
                <group string="Direction &amp; Resources">
                    <field name="audit_direction" nolabel="1"
                           placeholder="Resources, team deployment, supervision requirements..."/>
                    <group>
                        <field name="budgeted_hours"/>
                    </group>
                    <field name="budget_breakdown" nolabel="1"/>
                </group>
                <group string="Audit Approach by Cycle">
                    <field name="revenue_approach" nolabel="1" placeholder="Revenue Cycle Approach..."/>
                    <field name="purchases_approach" nolabel="1" placeholder="Purchases Cycle Approach..."/>
                    <field name="payroll_approach" nolabel="1" placeholder="Payroll Cycle Approach..."/>
                    <field name="inventory_approach" nolabel="1" placeholder="Inventory Approach..."/>
                    <field name="fixed_assets_approach" nolabel="1" placeholder="Fixed Assets Approach..."/>
                    <field name="cash_bank_approach" nolabel="1" placeholder="Cash &amp; Bank Approach..."/>
                    <field name="borrowings_approach" nolabel="1" placeholder="Borrowings Approach..."/>
                    <field name="equity_approach" nolabel="1" placeholder="Equity Approach..."/>
                </group>
                <group string="Attachments">
                    <field name="audit_plan_attachment_ids" widget="many2many_binary"/>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                        <button name="action_mark_prepared" type="object" string="Mark Prepared" class="btn-primary"/>
                        <button name="action_mark_reviewed" type="object" string="Mark Reviewed" class="btn-success"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
    <!-- P-13: Planning Review Embedded View -->
    <record id="view_planning_p13_review_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p13.review.form.embedded</field>
        <field name="model">audit.planning.p13.review</field>
        <field name="arch" type="xml">
            <form string="P-13: Planning Review">
                <group string="Planning Review Summary (ISA 220, ISQM-1)">
                    <field name="review_summary" nolabel="1"
                           placeholder="Overall summary of planning review..."/>
                </group>
                <group string="Manager Review">
                    <group>
                        <field name="manager_reviewed"/>
                        <field name="manager_reviewed_by" readonly="1"/>
                        <field name="manager_reviewed_on" readonly="1"/>
                    </group>
                    <group>
                        <button name="action_manager_review" type="object" 
                                string="Complete Manager Review" class="btn-primary"
                                invisible="manager_reviewed"/>
                    </group>
                    <field name="manager_review_notes" nolabel="1"/>
                </group>
                <group string="Partner Review">
                    <group>
                        <field name="partner_reviewed"/>
                        <field name="partner_reviewed_by" readonly="1"/>
                        <field name="partner_reviewed_on" readonly="1"/>
                    </group>
                    <group>
                        <button name="action_partner_review" type="object" 
                                string="Complete Partner Review" class="btn-warning"
                                invisible="partner_reviewed or not manager_reviewed"/>
                    </group>
                    <field name="partner_review_notes" nolabel="1"/>
                </group>
                <group string="EQCR Review">
                    <group>
                        <field name="eqcr_required"/>
                        <field name="eqcr_reviewed" invisible="not eqcr_required"/>
                        <field name="eqcr_reviewed_by" readonly="1" invisible="not eqcr_required"/>
                        <field name="eqcr_reviewed_on" readonly="1" invisible="not eqcr_required"/>
                    </group>
                    <group>
                        <button name="action_eqcr_review" type="object" 
                                string="Complete EQCR Review" class="btn-info"
                                invisible="not eqcr_required or eqcr_reviewed"/>
                    </group>
                    <field name="eqcr_review_notes" nolabel="1" invisible="not eqcr_required"/>
                </group>
                <group string="Outstanding Issues">
                    <group>
                        <field name="issues_resolved"/>
                    </group>
                    <field name="outstanding_issues" nolabel="1"
                           placeholder="Issues requiring resolution before execution..."/>
                </group>
                <group string="Final Approval">
                    <group>
                        <field name="planning_approved" readonly="1"/>
                        <field name="approved_by" readonly="1"/>
                        <field name="approved_on" readonly="1"/>
                        <field name="execution_authorized" readonly="1"/>
                    </group>
                    <group>
                        <button name="action_approve_planning" type="object" 
                                string="Approve Planning &amp; Authorize Execution" 
                                class="btn-success oe_highlight"
                                invisible="planning_approved or not partner_reviewed"/>
                    </group>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
</odoo>
