<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ═══════════════════════════════════════════════════════════════════════
         Embedded Form Views for Planning Tabs P-1 through P-6
         ═══════════════════════════════════════════════════════════════════════ -->
    
    <!-- P-1: Team Setup Embedded View -->
    <record id="view_planning_p1_team_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p1.team.form.embedded</field>
        <field name="model">audit.planning.p1.team</field>
        <field name="arch" type="xml">
            <form string="P-1: Team Setup">
                <group>
                    <group string="Engagement Team (ISA 220)">
                        <field name="engagement_partner_id"/>
                        <field name="engagement_manager_id"/>
                        <field name="team_member_ids" widget="many2many_tags"/>
                    </group>
                    <group string="Quality Control (ISQM-1)">
                        <field name="eqcr_required"/>
                        <field name="eqcr_reviewer_id" invisible="not eqcr_required"/>
                    </group>
                </group>
                <group string="Engagement Letter (ISA 210)">
                    <group>
                        <field name="engagement_letter_signed"/>
                        <field name="engagement_letter_date"/>
                    </group>
                    <group>
                        <field name="engagement_letter_attachment_ids" widget="many2many_binary"/>
                    </group>
                </group>
                <group string="Independence &amp; Ethics (IESBA Code)">
                    <group>
                        <field name="independence_confirmed"/>
                    </group>
                    <group>
                        <field name="independence_threats_identified" nolabel="1" 
                               placeholder="Document any independence threats and safeguards applied..."/>
                    </group>
                </group>
                <group string="Team Competence &amp; Supervision">
                    <field name="competence_assessment" nolabel="1" 
                           placeholder="Assessment of team competence for the engagement..."/>
                    <field name="supervision_plan" nolabel="1" 
                           placeholder="Plan for direction, supervision, and review..."/>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"
                           placeholder="Document key decisions and considerations for P-1..."/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                        <button name="action_mark_prepared" type="object" string="Mark Prepared" class="btn-primary"/>
                        <button name="action_mark_reviewed" type="object" string="Mark Reviewed" class="btn-success"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
    <!-- P-2: Entity Understanding Embedded View -->
    <record id="view_planning_p2_entity_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p2.entity.form.embedded</field>
        <field name="model">audit.planning.p2.entity</field>
        <field name="arch" type="xml">
            <form string="P-2: Entity Understanding">
                <group string="External Factors (ISA 315)">
                    <field name="industry_conditions" nolabel="1" 
                           placeholder="Market conditions, competition, technology, supply/demand..."/>
                    <field name="regulatory_environment" nolabel="1" 
                           placeholder="Applicable laws, regulations, regulatory bodies..."/>
                    <field name="economic_conditions" nolabel="1" 
                           placeholder="Interest rates, inflation, currency, economic trends..."/>
                </group>
                <group string="Nature of the Entity">
                    <field name="business_operations" nolabel="1" 
                           placeholder="Products, services, markets, customers, suppliers..."/>
                    <field name="ownership_governance" nolabel="1" 
                           placeholder="Shareholders, board composition, governance framework..."/>
                    <field name="organizational_structure" nolabel="1" 
                           placeholder="Management structure, reporting lines, key personnel..."/>
                </group>
                <group string="Accounting &amp; Objectives">
                    <group>
                        <field name="accounting_framework"/>
                    </group>
                    <group>
                        <field name="accounting_policies" placeholder="Key accounting policies..."/>
                    </group>
                    <field name="entity_objectives" nolabel="1" 
                           placeholder="Business objectives, strategies, and related risks..."/>
                    <field name="financial_performance" nolabel="1" 
                           placeholder="KPIs, budgets, forecasts, variance analysis..."/>
                </group>
                <group string="Attachments">
                    <field name="organogram_attachment_ids" widget="many2many_binary"/>
                    <field name="moa_aoa_attachment_ids" widget="many2many_binary"/>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                        <button name="action_mark_prepared" type="object" string="Mark Prepared" class="btn-primary"/>
                        <button name="action_mark_reviewed" type="object" string="Mark Reviewed" class="btn-success"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
    <!-- P-3: Internal Controls Embedded View -->
    <record id="view_planning_p3_controls_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p3.controls.form.embedded</field>
        <field name="model">audit.planning.p3.controls</field>
        <field name="arch" type="xml">
            <form string="P-3: Internal Controls">
                <group string="Control Environment (ISA 315)">
                    <group>
                        <field name="control_environment_rating" widget="radio"/>
                    </group>
                    <group>
                        <field name="control_environment" placeholder="Integrity, ethical values, governance..."/>
                    </group>
                </group>
                <group string="Risk Assessment &amp; Information System">
                    <field name="entity_risk_assessment" nolabel="1" 
                           placeholder="How entity identifies and addresses business risks..."/>
                    <field name="information_system" nolabel="1" 
                           placeholder="Systems for recording, processing, reporting..."/>
                    <field name="it_environment" nolabel="1" 
                           placeholder="IT systems, applications, databases, ITGCs..."/>
                </group>
                <group string="Control Activities &amp; Monitoring">
                    <field name="control_activities" nolabel="1" 
                           placeholder="Policies and procedures addressing significant risks..."/>
                    <field name="monitoring_activities" nolabel="1" 
                           placeholder="Ongoing and separate evaluations..."/>
                    <group>
                        <field name="internal_audit_function"/>
                    </group>
                    <field name="internal_audit_assessment" nolabel="1" 
                           invisible="not internal_audit_function"/>
                </group>
                <group string="Control Deficiencies &amp; Reliance">
                    <field name="control_deficiencies" nolabel="1"/>
                    <group>
                        <field name="reliance_on_controls"/>
                    </group>
                    <field name="reliance_justification" nolabel="1" 
                           invisible="not reliance_on_controls"/>
                </group>
                <group string="Attachments">
                    <field name="control_questionnaire_ids" widget="many2many_binary"/>
                    <field name="process_flowchart_ids" widget="many2many_binary"/>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                        <button name="action_mark_prepared" type="object" string="Mark Prepared" class="btn-primary"/>
                        <button name="action_mark_reviewed" type="object" string="Mark Reviewed" class="btn-success"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
    <!-- P-4: Analytics Embedded View -->
    <record id="view_planning_p4_analytics_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p4.analytics.form.embedded</field>
        <field name="model">audit.planning.p4.analytics</field>
        <field name="arch" type="xml">
            <form string="P-4: Preliminary Analytics">
                <group string="Financial Data (ISA 520)">
                    <group string="Prior Year">
                        <field name="prior_year_revenue"/>
                        <field name="prior_year_assets"/>
                        <field name="prior_year_profit"/>
                        <field name="prior_year_equity"/>
                    </group>
                    <group string="Current Year (Draft)">
                        <field name="current_year_revenue"/>
                        <field name="current_year_assets"/>
                        <field name="current_year_profit"/>
                        <field name="current_year_equity"/>
                    </group>
                </group>
                <group string="Analytical Procedures">
                    <field name="trend_analysis" nolabel="1" 
                           placeholder="3-5 year trend analysis of key financial data..."/>
                    <field name="ratio_analysis" nolabel="1" 
                           placeholder="Liquidity, profitability, solvency, efficiency ratios..."/>
                    <field name="industry_comparison" nolabel="1" 
                           placeholder="Comparison with industry benchmarks and peers..."/>
                </group>
                <group string="Fluctuations &amp; Expectations">
                    <field name="significant_fluctuations" nolabel="1" 
                           placeholder="Variances &gt;10% or exceeding materiality..."/>
                    <field name="analytical_expectations" nolabel="1" 
                           placeholder="Expected relationships and predictable patterns..."/>
                </group>
                <group string="Conclusions">
                    <field name="analytics_conclusions" nolabel="1"/>
                </group>
                <group string="Attachments">
                    <field name="trial_balance_ids" widget="many2many_binary"/>
                    <field name="prior_year_fs_ids" widget="many2many_binary"/>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                        <button name="action_mark_prepared" type="object" string="Mark Prepared" class="btn-primary"/>
                        <button name="action_mark_reviewed" type="object" string="Mark Reviewed" class="btn-success"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
    <!-- P-5: Materiality Embedded View -->
    <record id="view_planning_p5_materiality_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p5.materiality.form.embedded</field>
        <field name="model">audit.planning.p5.materiality</field>
        <field name="arch" type="xml">
            <form string="P-5: Materiality">
                <group string="Benchmark Selection (ISA 320)">
                    <group>
                        <field name="benchmark" required="1"/>
                        <field name="benchmark_amount" required="1"/>
                        <field name="materiality_percentage"/>
                    </group>
                    <group>
                        <field name="benchmark_justification" required="1"
                               placeholder="Justify why this benchmark is appropriate..."/>
                    </group>
                </group>
                <group string="Calculated Materiality">
                    <group>
                        <field name="overall_materiality" readonly="1"/>
                        <field name="performance_materiality_percentage"/>
                        <field name="performance_materiality" readonly="1"/>
                    </group>
                    <group>
                        <field name="trivial_percentage"/>
                        <field name="trivial_threshold" readonly="1"/>
                    </group>
                </group>
                <group string="Specific Materiality">
                    <group>
                        <field name="specific_materiality_required"/>
                    </group>
                    <field name="specific_materiality_items" nolabel="1"
                           invisible="not specific_materiality_required"
                           placeholder="Related party transactions, director remuneration, etc."/>
                </group>
                <group string="Revision Considerations">
                    <field name="revision_factors" nolabel="1"
                           placeholder="Circumstances that may require revision during the audit..."/>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                        <button name="action_mark_prepared" type="object" string="Mark Prepared" class="btn-primary"/>
                        <button name="action_mark_reviewed" type="object" string="Mark Reviewed" class="btn-success"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
    <!-- P-6: Risk Assessment Embedded View -->
    <record id="view_planning_p6_risk_embedded" model="ir.ui.view">
        <field name="name">audit.planning.p6.risk.form.embedded</field>
        <field name="model">audit.planning.p6.risk</field>
        <field name="arch" type="xml">
            <form string="P-6: Risk Assessment">
                <group string="Risk Assessment Approach (ISA 315)">
                    <field name="risk_assessment_approach" nolabel="1"
                           placeholder="Methodology for identifying and assessing risks..."/>
                </group>
                <group string="Financial Statement Level Risks">
                    <field name="fs_risk_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="sequence" widget="handle"/>
                            <field name="name"/>
                            <field name="risk_category"/>
                            <field name="risk_level"/>
                            <field name="is_significant"/>
                            <field name="response"/>
                        </tree>
                    </field>
                </group>
                <group string="Assertion Level Risks">
                    <field name="assertion_risk_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="account_cycle"/>
                            <field name="assertion_type"/>
                            <field name="risk_description"/>
                            <field name="inherent_risk"/>
                            <field name="control_risk"/>
                            <field name="risk_level" readonly="1"/>
                            <field name="is_significant"/>
                            <field name="planned_procedures"/>
                        </tree>
                    </field>
                </group>
                <group string="Risk Summary">
                    <group>
                        <field name="aggregated_risk_level" readonly="1" widget="badge"/>
                    </group>
                    <field name="significant_risk_summary" nolabel="1"/>
                    <field name="risk_response_overview" nolabel="1"/>
                </group>
                <group string="Working Notes (Mandatory)">
                    <field name="notes" nolabel="1" required="1"/>
                </group>
                <group>
                    <group string="Preparation">
                        <field name="prepared_by"/>
                        <field name="prepared_on"/>
                        <field name="review_status" widget="badge"/>
                    </group>
                    <group string="Review">
                        <field name="reviewed_by"/>
                        <field name="reviewed_on"/>
                        <button name="action_mark_prepared" type="object" string="Mark Prepared" class="btn-primary"/>
                        <button name="action_mark_reviewed" type="object" string="Mark Reviewed" class="btn-success"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
    
</odoo>
