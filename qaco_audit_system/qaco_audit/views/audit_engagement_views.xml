<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_qaco_audit_engagement_tree" model="ir.ui.view">
        <field name="name">qaco.audit.engagement.tree</field>
        <field name="model">qaco.audit.engagement</field>
        <field name="arch" type="xml">
            <tree string="Audit Engagements" decoration-danger="risk_rating == 'very_high'" decoration-warning="risk_rating == 'high'">
                <field name="name"/>
                <field name="client_id"/>
                <field name="entity_classification"/>
                <field name="state"/>
                <field name="risk_rating"/>
            </tree>
        </field>
    </record>

    <record id="view_qaco_audit_engagement_form" model="ir.ui.view">
        <field name="name">qaco.audit.engagement.form</field>
        <field name="model">qaco.audit.engagement</field>
        <field name="arch" type="xml">
            <form string="Audit Engagement">
                <header>
                    <button name="action_accept_engagement" type="object" string="Accept" class="oe_highlight" modifiers="{'invisible': [('state', '!=', 'draft')]}"/>
                    <button name="action_request_partner_review" type="object" string="Request Partner Review" modifiers="{'invisible': [('state', 'not in', ['draft','onboarding','planning'])]}"/>
                    <button name="action_mark_partner_review_complete" type="object" string="Partner Review Complete" modifiers="{'invisible': [('state', 'not in', ['onboarding','planning','execution'])]}"/>
                    <button name="action_reject_engagement" type="object" string="Reject" modifiers="{'invisible': [('state', 'not in', ['draft','onboarding'])]}"/>
                    <button name="action_send_professional_clearance" type="object" string="Request Professional Clearance" modifiers="{'invisible': [('state', 'not in', ['onboarding','planning'])]}"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,onboarding,planning,execution,finalisation,completed,cancelled"/>
                </header>
                <sheet>
                    <group>
                        <field name="name"/>
                        <field name="client_id"/>
                        <field name="partner_review_required" readonly="1"/>
                        <field name="partner_review_completed"/>
                        <field name="safeguards_documentation_required" readonly="1"/>
                        <field name="risk_rating"/>
                    </group>
                    <notebook>
                        <page string="1.1 Client Profile">
                            <group>
                                <field name="legal_name"/>
                                <field name="trade_name"/>
                                <field name="date_incorporation"/>
                            </group>
                            <group>
                                <field name="sector_code"/>
                                <field name="group_structure"/>
                            </group>
                            <group>
                                <field name="holding_subsidiaries"/>
                            </group>
                            <group>
                                <field name="ntn"/>
                                <field name="strn"/>
                                <field name="entity_classification"/>
                                <field name="regulatory_body"/>
                            </group>
                            <group>
                                <field name="industry_id"/>
                                <field name="registered_address"/>
                            </group>
                            <group>
                                <field name="branch_office_ids">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="location"/>
                                        <field name="city"/>
                                    </tree>
                                </field>
                            </group>
                            <group>
                                <field name="ubo_ids">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="relation"/>
                                        <field name="ownership_percentage"/>
                                        <field name="cnic"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="1.2 Regulatory Profile">
                            <group>
                                <field name="reporting_framework"/>
                                <field name="secp_status"/>
                                <field name="stock_exchange"/>
                            </group>
                            <group>
                                <field name="last_annual_return"/>
                                <field name="tax_compliance_rating"/>
                                <field name="withholding_tax_status"/>
                            </group>
                            <group>
                                <field name="regulatory_inspection_ids">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="authority"/>
                                        <field name="inspection_date"/>
                                    </tree>
                                </field>
                            </group>
                            <group>
                                <field name="corporate_compliance_summary"/>
                            </group>
                        </page>
                        <page string="1.3 Ownership & Governance">
                            <group>
                                <field name="shareholding_pattern"/>
                                <field name="board_composition"/>
                            </group>
                            <group>
                                <field name="ceo_name"/>
                                <field name="ceo_cnic"/>
                                <field name="cfo_name"/>
                                <field name="cfo_cnic"/>
                            </group>
                            <group>
                                <field name="company_secretary"/>
                                <field name="company_secretary_membership"/>
                                <field name="fit_proper_status"/>
                            </group>
                            <group>
                                <field name="pep_ids">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="designation"/>
                                        <field name="country"/>
                                        <field name="cnic"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="1.4 Risk Assessment">
                            <group>
                                <field name="management_integrity_rating"/>
                                <field name="aml_ctf_risk"/>
                                <field name="business_risk_factors"/>
                            </group>
                            <group>
                                <field name="reputation_assessment"/>
                                <field name="litigation_summary"/>
                            </group>
                            <group>
                                <field name="fraud_history"/>
                                <field name="fraud_history_details"/>
                            </group>
                            <group>
                                <field name="regulatory_penalties"/>
                                <field name="regulatory_penalties_details"/>
                            </group>
                        </page>
                        <page string="1.5 Independence & Ethics">
                            <group>
                                <field name="independence_threats"/>
                                <field name="safeguards_applied"/>
                                <field name="team_independence_confirmed"/>
                            </group>
                            <group>
                                <field name="prohibited_services_evaluated"/>
                                <field name="fee_dependency_percentage"/>
                                <field name="fee_dependency_acceptable"/>
                            </group>
                        </page>
                        <page string="1.6 Previous Auditor">
                            <group>
                                <field name="previous_auditor_id"/>
                                <field name="professional_clearance_request_date"/>
                                <field name="professional_clearance_response_date"/>
                            </group>
                            <group>
                                <field name="outstanding_fees"/>
                                <field name="professional_disagreements"/>
                            </group>
                            <group>
                                <field name="fraud_knowledge_previous"/>
                                <field name="fraud_knowledge_details"/>
                                <field name="material_misstatements_previous"/>
                            </group>
                        </page>
                        <page string="1.7 Engagement Authorization">
                            <group>
                                <field name="preconditions_met"/>
                                <field name="management_responsibilities_acknowledged"/>
                                <field name="engagement_terms_understood"/>
                                <field name="engagement_decision"/>
                            </group>
                            <group>
                                <field name="eqcr_required"/>
                                <field name="eqcr_approved"/>
                                <field name="eqcr_approval_date"/>
                            </group>
                        </page>
                        <page string="1.8 Documents Checklist">
                            <group>
                                <field name="doc_certificate_incorporation"/>
                                <field name="doc_moa_aoa"/>
                                <field name="doc_audited_fs_3years"/>
                                <field name="doc_prior_management_letters"/>
                            </group>
                            <group>
                                <field name="doc_legal_cases"/>
                                <field name="doc_aml_kyc"/>
                                <field name="doc_independence_confirmations"/>
                                <field name="doc_professional_clearance"/>
                                <field name="doc_engagement_letter_signed"/>
                                <field name="doc_conflict_declarations"/>
                            </group>
                        </page>
                        <page string="1.9 Onboarding Checklists">
                            <group>
                                <field name="acceptance_checklist_ids">
                                    <tree editable="bottom">
                                        <field name="question"/>
                                        <field name="status"/>
                                        <field name="note"/>
                                    </tree>
                                </field>
                                <field name="acceptance_checklist_complete" readonly="1"/>
                            </group>
                            <group>
                                <field name="independence_checklist_ids">
                                    <tree editable="bottom">
                                        <field name="question"/>
                                        <field name="status"/>
                                        <field name="note"/>
                                    </tree>
                                </field>
                                <field name="independence_checklist_complete" readonly="1"/>
                            </group>
                            <group>
                                <field name="isqm_checklist_ids">
                                    <tree editable="bottom">
                                        <field name="question"/>
                                        <field name="status"/>
                                        <field name="note"/>
                                    </tree>
                                </field>
                                <field name="isqm_checklist_complete" readonly="1"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
</odoo>