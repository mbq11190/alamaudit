<odoo>
  <!-- Menu and action -->
  <record id="action_qaco_planning_plan" model="ir.actions.act_window">
    <field name="name">Audit Planning (ISA)</field>
    <field name="res_model">qaco.planning.plan</field>
    <field name="view_mode">kanban,tree,form</field>
    <field name="context">{}</field>
  </record>

  <menuitem id="menu_qaco_planning_root" name="Audit Planning (ISA)" sequence="40"/>
  <menuitem id="menu_qaco_planning_plan" name="Plans" parent="menu_qaco_planning_root" action="action_qaco_planning_plan" sequence="10"/>

  <!-- Kanban -->
  <record id="view_qaco_planning_plan_kanban" model="ir.ui.view">
    <field name="name">qaco.planning.plan.kanban</field>
    <field name="model">qaco.planning.plan</field>
    <field name="arch" type="xml">
      <kanban default_group_by="state" class="o_kanban_small_column">
        <templates>
          <t t-name="kanban-box">
            <div t-attf-class="oe_kanban_global_click o_kanban_record {{record.color.raw_value ? 'o_kanban_color_'+record.color.raw_value : ''}}">
              <div class="o_kanban_primary_left">
                <strong><field name="name"/></strong>
                <div><span>Audit:</span> <field name="audit_id"/></div>
                <div class="o_progressbar">
                  <t t-if="record.progress.value">
                    <div class="progress">
                      <div class="progress-bar" t-att-style="'width:'+record.progress.value+'%;'"><t t-esc="record.progress.value"/>%</div>
                    </div>
                  </t>
                </div>
              </div>
              <div class="o_kanban_primary_right">
                <field name="color" widget="color_picker"/>
              </div>
              <div class="o_kanban_tags">
                <span t-if="record.engagement_letter_obtained.raw_value" class="badge text-bg-success">Engagement Letter</span>
                <span t-if="record.independence_confirmed.raw_value" class="badge text-bg-success">Independence</span>
              </div>
            </div>
          </t>
        </templates>
        <field name="name"/>
        <field name="audit_id"/>
        <field name="progress"/>
        <field name="color"/>
        <field name="engagement_letter_obtained"/>
        <field name="independence_confirmed"/>
        <field name="state"/>
      </kanban>
    </field>
  </record>

  <!-- Tree -->
  <record id="view_qaco_planning_plan_tree" model="ir.ui.view">
    <field name="name">qaco.planning.plan.tree</field>
    <field name="model">qaco.planning.plan</field>
    <field name="arch" type="xml">
      <tree>
        <field name="name"/>
        <field name="audit_id"/>
        <field name="partner_id"/>
        <field name="manager_id"/>
        <field name="materiality_basis"/>
        <field name="materiality_amount"/>
        <field name="progress"/>
        <field name="state"/>
      </tree>
    </field>
  </record>

  <!-- Form -->
  <record id="view_qaco_planning_plan_form" model="ir.ui.view">
    <field name="name">qaco.planning.plan.form</field>
    <field name="model">qaco.planning.plan</field>
    <field name="arch" type="xml">
      <form string="Audit Planning">
        <header>
          <button name="action_start" type="object" string="Start" states="draft" class="btn-primary"/>
          <button name="action_submit_review" type="object" string="Submit for Review" states="in_progress" class="btn-secondary"/>
          <button name="action_approve" type="object" string="Approve" states="review" class="btn-success"/>
          <field name="state" widget="statusbar" statusbar_visible="draft,in_progress,review,approved"/>
        </header>
        <sheet>
          <div class="oe_button_box" name="button_box">
            <button type="action" class="oe_stat_button" name="%(action_qaco_planning_risk)d" context="{'search_default_plan_id': active_id, 'default_plan_id': active_id}">
              <span class="o_stat_text">Risks</span>
              <span class="o_stat_value"><field name="risk_ids" widget="statinfo"/></span>
            </button>
            <button type="action" class="oe_stat_button" name="%(action_qaco_planning_pbc)d" context="{'search_default_plan_id': active_id, 'default_plan_id': active_id}">
              <span class="o_stat_text">PBC</span>
              <span class="o_stat_value"><field name="pbc_ids" widget="statinfo"/></span>
            </button>
            <button type="action" class="oe_stat_button" name="%(action_qaco_planning_milestone)d" context="{'search_default_plan_id': active_id, 'default_plan_id': active_id}">
              <span class="o_stat_text">Milestones</span>
              <span class="o_stat_value"><field name="milestone_ids" widget="statinfo"/></span>
            </button>
          </div>

          <group>
            <group>
              <field name="name" readonly="1"/>
              <field name="audit_id" options="{'no_open': True}"/>
              <field name="partner_id"/>
              <field name="manager_id"/>
              <field name="team_ids" widget="many2many_tags"/>
              <field name="color" widget="color_picker"/>
            </group>
            <group>
              <field name="engagement_letter_obtained"/>
              <field name="independence_confirmed"/>
              <field name="progress" widget="progressbar"/>
            </group>
          </group>

          <notebook>
            <page string="Strategy (ISA 300)">
              <group>
                <field name="overall_strategy" placeholder="Overall strategy, timing, and direction of the audit..."/>
                <field name="scope"/>
                <field name="use_of_experts"/>
                <field name="rely_on_internal_audit"/>
                <field name="significant_components"/>
              </group>
            </page>

            <page string="Materiality (ISA 320)">
              <group>
                <field name="materiality_basis"/>
                <field name="materiality_amount"/>
                <field name="performance_materiality"/>
                <field name="trivial_misstatement"/>
                <field name="materiality_notes"/>
              </group>
            </page>

            <page string="Risks (ISA 315/240)">
              <field name="risk_ids">
                <tree editable="bottom">
                  <field name="name"/>
                  <field name="assertion"/>
                  <field name="likelihood"/>
                  <field name="impact"/>
                  <field name="risk_score" readonly="1"/>
                  <field name="significant"/>
                  <field name="response"/>
                  <field name="isa_ref"/>
                </tree>
              </field>
            </page>

            <page string="Checklist">
              <field name="checklist_ids" context="{'default_owner_id': uid}" >
                <tree editable="bottom">
                  <field name="sequence" widget="handle"/>
                  <field name="section"/>
                  <field name="description"/>
                  <field name="isa_ref"/>
                  <field name="owner_id"/>
                  <field name="done"/>
                </tree>
              </field>
            </page>

            <page string="PBC">
              <field name="pbc_ids" context="{'default_received': False}">
                <tree editable="bottom">
                  <field name="name"/>
                  <field name="partner_contact"/>
                  <field name="due_date"/>
                  <field name="received"/>
                </tree>
              </field>
            </page>

            <page string="Timeline">
              <field name="milestone_ids">
                <tree editable="bottom">
                  <field name="name"/>
                  <field name="category"/>
                  <field name="date"/>
                  <field name="completed"/>
                </tree>
              </field>
            </page>
          </notebook>
        </sheet>
        <chatter/>
      </form>
    </field>
  </record>

  <!-- Risk action/list -->
  <record id="action_qaco_planning_risk" model="ir.actions.act_window">
    <field name="name">Planning Risks</field>
    <field name="res_model">qaco.planning.risk</field>
    <field name="view_mode">tree,form</field>
    <field name="context">{}</field>
  </record>

  <!-- PBC action/list -->
  <record id="action_qaco_planning_pbc" model="ir.actions.act_window">
    <field name="name">PBC Items</field>
    <field name="res_model">qaco.planning.pbc</field>
    <field name="view_mode">tree,form</field>
  </record>

  <!-- Milestones action/list -->
  <record id="action_qaco_planning_milestone" model="ir.actions.act_window">
    <field name="name">Milestones</field>
    <field name="res_model">qaco.planning.milestone</field>
    <field name="view_mode">tree,form</field>
  </record>
</odoo>
