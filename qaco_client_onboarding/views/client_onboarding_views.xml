<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Client Onboarding Form View -->
        <record id="view_client_onboarding_form" model="ir.ui.view">
            <field name="name">qaco.client.onboarding.form</field>
            <field name="model">qaco.client.onboarding</field>
            <field name="arch" type="xml">
                <form string="Client Onboarding">
                    <header>
                        <button name="action_start_kyc_review" string="Start KYC Review" type="object" 
                                class="oe_highlight" invisible="state != 'draft'"/>
                        <button name="action_start_conflict_check" string="Start Conflict Check" type="object" 
                                class="oe_highlight" invisible="state != 'kyc_review'"/>
                        <button name="action_start_independence_check" string="Start Independence Check" type="object" 
                                class="oe_highlight" invisible="state != 'conflict_check'"/>
                        <button name="action_start_acceptance_review" string="Start Acceptance Review" type="object" 
                                class="oe_highlight" invisible="state != 'independence_check'"/>
                        <button name="action_prepare_proposal" string="Prepare Proposal" type="object" 
                                class="oe_highlight" invisible="state != 'acceptance_review'"/>
                        <button name="action_prepare_engagement_letter" string="Prepare Engagement Letter" type="object" 
                                class="oe_highlight" invisible="state != 'proposal_preparation'"/>
                        <button name="action_approve" string="Approve" type="object" 
                                class="oe_highlight" invisible="state != 'engagement_letter'"/>
                        <button name="action_reject" string="Reject" type="object" 
                                invisible="state in ('approved', 'rejected')"/>
                        <button name="action_reset_to_draft" string="Reset to Draft" type="object" 
                                invisible="state == 'draft'"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,kyc_review,conflict_check,independence_check,acceptance_review,proposal_preparation,engagement_letter,approved"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="audit_id" options="{'no_create': True}"/>
                                <field name="client_id"/>
                                <field name="onboarding_date"/>
                                <field name="acceptance_evaluation" widget="badge" decoration-success="acceptance_evaluation == 'low_risk'" decoration-warning="acceptance_evaluation == 'medium_risk'" decoration-danger="acceptance_evaluation == 'high_risk'"/>
                            </group>
                            <group>
                                <field name="responsible_partner_id"/>
                                <field name="responsible_manager_id"/>
                                <field name="is_new_client"/>
                                <field name="is_recurring_client"/>
                            </group>
                        </group>
                        <notebook>
                            <!-- Client Information Tab -->
                            <page string="Client Information">
                                <group>
                                    <group>
                                        <field name="client_since"/>
                                        <field name="previous_auditor"/>
                                        <field name="reason_for_change"/>
                                    </group>
                                    <group>
                                        <field name="previous_auditor_contacted"/>
                                        <field name="previous_auditor_response" invisible="not previous_auditor_contacted"/>
                                    </group>
                                </group>
                            </page>

                            <!-- KYC Documentation Tab -->
                            <page string="KYC Documentation">
                                <group>
                                    <field name="kyc_documents_complete"/>
                                </group>
                                <group string="Required Documents">
                                    <group>
                                        <label for="company_registration"/>
                                        <div class="o_row">
                                            <field name="company_registration" filename="company_registration_filename"/>
                                            <field name="company_registration_filename" invisible="1"/>
                                        </div>
                                        <label for="articles_of_association"/>
                                        <div class="o_row">
                                            <field name="articles_of_association" filename="articles_filename"/>
                                            <field name="articles_filename" invisible="1"/>
                                        </div>
                                        <label for="beneficial_ownership_docs"/>
                                        <div class="o_row">
                                            <field name="beneficial_ownership_docs" filename="beneficial_ownership_filename"/>
                                            <field name="beneficial_ownership_filename" invisible="1"/>
                                        </div>
                                    </group>
                                    <group>
                                        <label for="director_id_copies"/>
                                        <div class="o_row">
                                            <field name="director_id_copies" filename="director_id_filename"/>
                                            <field name="director_id_filename" invisible="1"/>
                                        </div>
                                        <label for="address_proof"/>
                                        <div class="o_row">
                                            <field name="address_proof" filename="address_proof_filename"/>
                                            <field name="address_proof_filename" invisible="1"/>
                                        </div>
                                        <label for="tax_registration"/>
                                        <div class="o_row">
                                            <field name="tax_registration" filename="tax_registration_filename"/>
                                            <field name="tax_registration_filename" invisible="1"/>
                                        </div>
                                    </group>
                                </group>
                            </page>

                            <!-- Due Diligence Tab -->
                            <page string="Due Diligence">
                                <group string="Background Checks">
                                    <group>
                                        <field name="background_check_completed"/>
                                        <field name="background_check_date"/>
                                        <field name="background_check_findings"/>
                                    </group>
                                    <group>
                                        <field name="adverse_media_check"/>
                                        <field name="adverse_media_findings"/>
                                    </group>
                                </group>
                                <group string="Screening">
                                    <group>
                                        <field name="sanctions_screening_completed"/>
                                        <field name="sanctions_screening_result"/>
                                    </group>
                                    <group>
                                        <field name="pep_screening_completed"/>
                                        <field name="pep_screening_result"/>
                                    </group>
                                </group>
                            </page>

                            <!-- Conflict Check Tab -->
                            <page string="Conflict Check">
                                <group>
                                    <group>
                                        <field name="conflict_check_completed"/>
                                        <field name="conflict_check_date"/>
                                        <field name="conflicts_identified"/>
                                    </group>
                                    <group>
                                        <field name="conflict_waiver_obtained" invisible="not conflicts_identified"/>
                                    </group>
                                </group>
                                <group invisible="not conflicts_identified">
                                    <field name="conflict_details" nolabel="1" placeholder="Describe the conflicts identified..."/>
                                    <field name="conflict_resolution" nolabel="1" placeholder="Describe safeguards or resolution measures..."/>
                                </group>
                            </page>

                            <!-- Independence Tab -->
                            <page string="Independence">
                                <group>
                                    <group>
                                        <field name="independence_check_completed"/>
                                        <field name="independence_threats_identified"/>
                                        <field name="rotation_requirements_met"/>
                                    </group>
                                </group>
                                <group invisible="not independence_threats_identified">
                                    <field name="independence_threat_details" nolabel="1" placeholder="Describe independence threats..."/>
                                    <field name="independence_safeguards" nolabel="1" placeholder="Describe safeguards applied..."/>
                                </group>
                                <group>
                                    <field name="rotation_notes" nolabel="1" placeholder="Partner/key audit team rotation notes..."/>
                                </group>
                            </page>

                            <!-- Competence &amp; Resources Tab -->
                            <page string="Competence &amp; Resources">
                                <group>
                                    <group>
                                        <field name="technical_competence_assessed"/>
                                        <field name="industry_expertise_available"/>
                                        <field name="resources_available"/>
                                    </group>
                                </group>
                                <group>
                                    <field name="specialist_skills_required" nolabel="1" placeholder="Specialist skills or experts required (e.g., IT, valuation, tax)..."/>
                                    <field name="resource_notes" nolabel="1" placeholder="Resource assessment and allocation notes..."/>
                                </group>
                            </page>

                            <!-- Fee Proposal Tab -->
                            <page string="Fee Proposal">
                                <group>
                                    <group>
                                        <field name="proposed_fee"/>
                                        <field name="currency_id" invisible="1"/>
                                        <field name="fee_basis"/>
                                        <field name="estimated_hours"/>
                                    </group>
                                    <group>
                                        <field name="fee_proposal_sent"/>
                                        <field name="fee_proposal_date"/>
                                        <field name="fee_accepted"/>
                                        <field name="fee_acceptance_date"/>
                                    </group>
                                </group>
                            </page>

                            <!-- Engagement Letter Tab -->
                            <page string="Engagement Letter">
                                <group>
                                    <group>
                                        <field name="engagement_letter_prepared"/>
                                        <label for="engagement_letter"/>
                                        <div class="o_row">
                                            <field name="engagement_letter" filename="engagement_letter_filename"/>
                                            <field name="engagement_letter_filename" invisible="1"/>
                                        </div>
                                        <field name="engagement_letter_sent"/>
                                        <field name="engagement_letter_sent_date"/>
                                    </group>
                                    <group>
                                        <field name="engagement_letter_signed"/>
                                        <field name="engagement_letter_signed_date"/>
                                        <label for="signed_engagement_letter"/>
                                        <div class="o_row">
                                            <field name="signed_engagement_letter" filename="signed_engagement_letter_filename"/>
                                            <field name="signed_engagement_letter_filename" invisible="1"/>
                                        </div>
                                    </group>
                                </group>
                            </page>

                            <!-- Terms &amp; Compliance Tab -->
                            <page string="Terms &amp; Compliance">
                                <group>
                                    <group>
                                        <field name="terms_accepted"/>
                                        <field name="terms_acceptance_date"/>
                                    </group>
                                    <group>
                                        <field name="data_privacy_consent"/>
                                        <field name="aml_questionnaire_completed"/>
                                    </group>
                                </group>
                            </page>

                            <!-- Approval &amp; Decision Tab -->
                            <page string="Approval &amp; Decision">
                                <group>
                                    <group>
                                        <field name="acceptance_decision" widget="badge" decoration-success="acceptance_decision == 'accept'" decoration-warning="acceptance_decision == 'accept_with_conditions'" decoration-danger="acceptance_decision == 'reject'"/>
                                        <field name="partner_approval"/>
                                        <field name="partner_approval_date"/>
                                    </group>
                                </group>
                                <group invisible="acceptance_decision != 'accept_with_conditions'">
                                    <field name="acceptance_conditions" nolabel="1" placeholder="Specify conditions for acceptance..."/>
                                </group>
                                <group invisible="acceptance_decision != 'reject'">
                                    <field name="rejection_reason" nolabel="1" placeholder="Specify reason for rejection..."/>
                                </group>
                                <group>
                                    <field name="notes" nolabel="1" placeholder="Additional notes and observations..."/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Client Onboarding Tree View -->
        <record id="view_client_onboarding_tree" model="ir.ui.view">
            <field name="name">qaco.client.onboarding.tree</field>
            <field name="model">qaco.client.onboarding</field>
            <field name="arch" type="xml">
                <tree string="Client Onboarding">
                    <field name="name"/>
                    <field name="audit_id"/>
                    <field name="client_id"/>
                    <field name="onboarding_date"/>
                    <field name="responsible_partner_id"/>
                    <field name="acceptance_evaluation" widget="badge" decoration-success="acceptance_evaluation == 'low_risk'" decoration-warning="acceptance_evaluation == 'medium_risk'" decoration-danger="acceptance_evaluation == 'high_risk'"/>
                    <field name="state" widget="badge" decoration-success="state == 'approved'" decoration-danger="state == 'rejected'" decoration-info="state in ('draft', 'kyc_review', 'conflict_check')"/>
                </tree>
            </field>
        </record>

        <!-- Client Onboarding Search View -->
        <record id="view_client_onboarding_search" model="ir.ui.view">
            <field name="name">qaco.client.onboarding.search</field>
            <field name="model">qaco.client.onboarding</field>
            <field name="arch" type="xml">
                <search string="Client Onboarding">
                    <field name="name"/>
                    <field name="audit_id"/>
                    <field name="client_id"/>
                    <field name="responsible_partner_id"/>
                    <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>
                    <filter string="In Progress" name="in_progress" domain="[('state', 'in', ('kyc_review', 'conflict_check', 'independence_check', 'acceptance_review', 'proposal_preparation', 'engagement_letter'))]"/>
                    <filter string="Approved" name="approved" domain="[('state', '=', 'approved')]"/>
                    <filter string="Rejected" name="rejected" domain="[('state', '=', 'rejected')]"/>
                    <separator/>
                    <filter string="New Clients" name="new_clients" domain="[('is_new_client', '=', True)]"/>
                    <filter string="Recurring Clients" name="recurring_clients" domain="[('is_recurring_client', '=', True)]"/>
                    <separator/>
                    <filter string="Low Risk" name="low_risk" domain="[('acceptance_evaluation', '=', 'low_risk')]"/>
                    <filter string="Medium Risk" name="medium_risk" domain="[('acceptance_evaluation', '=', 'medium_risk')]"/>
                    <filter string="High Risk" name="high_risk" domain="[('acceptance_evaluation', '=', 'high_risk')]"/>
                    <group expand="0" string="Group By">
                        <filter string="Status" name="group_state" context="{'group_by': 'state'}"/>
                        <filter string="Risk Rating" name="group_risk" context="{'group_by': 'acceptance_evaluation'}"/>
                        <filter string="Responsible Partner" name="group_partner" context="{'group_by': 'responsible_partner_id'}"/>
                        <filter string="Client" name="group_client" context="{'group_by': 'client_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Client Onboarding Action -->
        <record id="action_client_onboarding" model="ir.actions.act_window">
            <field name="name">Client Onboarding</field>
            <field name="res_model">qaco.client.onboarding</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new client onboarding record
                </p>
                <p>
                    Complete client acceptance evaluation, KYC, due diligence, and engagement setup.
                </p>
            </field>
        </record>
    </data>
</odoo>
