<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_client_onboarding_tree" model="ir.ui.view">
        <field name="name">qaco.client.onboarding.tree</field>
        <field name="model">qaco.client.onboarding</field>
        <field name="arch" type="xml">
            <tree string="Client Onboarding Records">
                <field name="name"/>
                <field name="client_id"/>
                <field name="overall_status"/>
            </tree>
        </field>
    </record>

    <record id="view_client_onboarding_form" model="ir.ui.view">
        <field name="name">qaco.client.onboarding.form</field>
        <field name="model">qaco.client.onboarding</field>
        <field name="arch" type="xml">
            <form string="Client Onboarding">
                <header>
                    <field name="state" widget="statusbar" statusbar_visible="draft,under_review,partner_approved,locked" statusbar_colors="{'draft':'secondary','under_review':'warning','partner_approved':'success','locked':'primary'}"/>
                    <field name="overall_status" widget="statusbar" statusbar_visible="red,amber,green" statusbar_colors="{'red':'danger','amber':'warning','green':'success'}" readonly="1"/>
                    <button name="action_generate_acceptance_report" type="object" string="Generate Acceptance Report" class="btn-primary"/>
                    <button name="action_submit_review" type="object" string="Submit for Review" class="btn-secondary" modifiers="{'invisible': [('state','!=','draft')]}"/>
                    <button name="action_partner_approve" type="object" string="Partner Approve" class="btn-secondary" modifiers="{'invisible': [('state','!=','under_review')]}"/>
                    <button name="action_lock_onboarding" type="object" string="Lock Onboarding" class="btn-secondary" modifiers="{'invisible': [('state','!=','partner_approved')]}"/>
                </header>
                <sheet>
                    <!-- Header identifiers removed from visible layout -->
                    <notebook>
                        <page string="1.1 Legal Identity" name="section_1">
                            <group>
                                <field name="entity_type" help="Select the entity classification dictating compulsory thresholds and regulatory triggers."/>
                                <field name="other_entity_description" modifiers="{'invisible':[('entity_type','!=','other')]}"/>
                            </group>
                            <group>
                                <field name="legal_name" help="The name exactly as on the Certificate of Incorporation or registration document."/>
                                <field name="trading_name" help="Enter the trading name if it differs from the legal name."/>
                            </group>
                            <group>
                                <field name="principal_business_address" help="Enter the registered office as stated in legal filings."/>
                                <field name="primary_regulator" help="Select the principal regulator overseeing this entity."/>
                                <field name="regulator_other" modifiers="{'invisible':[('primary_regulator','!=','other')]}"/>
                            </group>
                            <group>
                                <field name="ntn" help="NTN must follow the NNNNNNN-N format for validation."/>
                                <field name="strn" help="Provide the Sales Tax Registration Number if applicable."/>
                                <field name="business_registration_number" help="Enter the number assigned by SECP or relevant authority."/>
                                <field name="industry_id" help="Select the primary industry; it auto-populates the risk profile."/>
                            </group>
                            <group>
                                <field name="org_chart_attachment" filename="org_chart_name" widget="binary"/>
                                <field name="org_chart_name" readonly="1"/>
                            </group>
                            <group>
                                <field name="branch_location_ids">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="address"/>
                                        <field name="country_id"/>
                                    </tree>
                                </field>
                            </group>
                            <group>
                                <field name="ubo_ids">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="cnic_passport"/>
                                        <field name="nationality"/>
                                        <field name="ownership_percent"/>
                                    </tree>
                                </field>
                            </group>
                            <group string="Standards &amp; Checklist">
                                <field name="regulator_checklist_line_ids" domain="[('onboarding_area','=','legal_identity') ]" modifiers="{'readonly': [('state','in',['partner_approved','locked'])]}" create="false" delete="false">
                                    <tree editable="bottom">
                                        <field name="code" readonly="1"/>
                                        <field name="name" readonly="1"/>
                                        <field name="mandatory" readonly="1"/>
                                        <field name="completed"/>
                                        <field name="completed_by" readonly="1"/>
                                        <field name="completed_on" readonly="1"/>
                                        <field name="standard_ids" widget="many2many_tags" readonly="1"/>
                                        <field name="notes"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="1.2 Regulatory &amp; Compliance" name="section_2">
                            <group>
                                <field name="financial_framework" help="Choose the accounting framework that governs audit procedures."/>
                                <field name="financial_framework_other" modifiers="{'invisible':[('financial_framework','!=','other_framework')]}"/>
                            </group>
                            <group>
                                <field name="annual_return_last_filed"/>
                                <field name="annual_return_overdue"/>
                                <field name="fbr_compliance_rating"/>
                            </group>
                            <group>
                                <field name="tax_assessment_history" help="Summarize tax assessments, litigations or disputes."/>
                                <field name="regulatory_inspection_notes" help="Detail any inspections by SECP, SBP, FBR or other regulators."/>
                                <field name="regulatory_inspection_attachment" filename="Regulatory Inspection Report" widget="binary"/>
                            </group>
                            <group string="Standards &amp; Checklist">
                                <field name="regulator_checklist_line_ids" domain="[('onboarding_area','=','regulatory_compliance') ]" modifiers="{'readonly': [('state','in',['partner_approved','locked'])]}" create="false" delete="false">
                                    <tree editable="bottom">
                                        <field name="code" readonly="1"/>
                                        <field name="name" readonly="1"/>
                                        <field name="mandatory" readonly="1"/>
                                        <field name="completed"/>
                                        <field name="completed_by" readonly="1"/>
                                        <field name="completed_on" readonly="1"/>
                                        <field name="standard_ids" widget="many2many_tags" readonly="1"/>
                                        <field name="notes"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="1.3 Ownership &amp; Governance" name="section_3">
                            <group>
                                <field name="shareholder_ids">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="share_class"/>
                                        <field name="percentage"/>
                                        <field name="voting_rights"/>
                                    </tree>
                                </field>
                            </group>
                            <group>
                                <field name="board_member_ids">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="cnic"/>
                                        <field name="din"/>
                                        <field name="role"/>
                                        <field name="is_pep"/>
                                    </tree>
                                </field>
                            </group>
                            <group>
                                <field name="fit_proper_confirmed"/>
                                <field name="fit_proper_document" widget="binary"/>
                                <field name="enhanced_due_diligence_required" readonly="1"/>
                                <field name="enhanced_due_diligence_details" invisible="not enhanced_due_diligence_required"/>
                                <field name="enhanced_due_diligence_attachment" invisible="not enhanced_due_diligence_required" widget="binary"/>
                            </group>
                            <group string="Standards &amp; Checklist">
                                <field name="regulator_checklist_line_ids" domain="[('onboarding_area','=','ownership_governance') ]" modifiers="{'readonly': [('state','in',['partner_approved','locked'])]}" create="false" delete="false">
                                    <tree editable="bottom">
                                        <field name="code" readonly="1"/>
                                        <field name="name" readonly="1"/>
                                        <field name="mandatory" readonly="1"/>
                                        <field name="completed"/>
                                        <field name="completed_by" readonly="1"/>
                                        <field name="completed_on" readonly="1"/>
                                        <field name="standard_ids" widget="many2many_tags" readonly="1"/>
                                        <field name="notes"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="1.4 Pre-Acceptance Risk" name="section_4">
                            <group>
                                <field name="management_integrity_rating" widget="radio"/>
                                <field name="management_integrity_comment" placeholder="Explain the rating referencing reputation, background and documentation."/>
                            </group>
                            <group>
                                <field name="litigation_history"/>
                                <field name="fraud_history"/>
                                <field name="fraud_explanation" invisible="fraud_history == 'no'"/>
                                <field name="aml_risk_rating" readonly="1"/>
                                <field name="eqcr_required" readonly="1" invisible="1"/>
                            </group>
                            <group>
                                <field name="business_risk_profile"/>
                                <field name="risk_mitigation_plan" required="eqcr_required"/>
                            </group>
                            <group string="Standards &amp; Checklist">
                                <field name="regulator_checklist_line_ids" domain="[('onboarding_area','=','pre_acceptance_risk') ]" modifiers="{'readonly': [('state','in',['partner_approved','locked'])]}" create="false" delete="false">
                                    <tree editable="bottom">
                                        <field name="code" readonly="1"/>
                                        <field name="name" readonly="1"/>
                                        <field name="mandatory" readonly="1"/>
                                        <field name="completed"/>
                                        <field name="completed_by" readonly="1"/>
                                        <field name="completed_on" readonly="1"/>
                                        <field name="standard_ids" widget="many2many_tags" readonly="1"/>
                                        <field name="notes"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="1.5 Independence &amp; Ethics" name="section_5">
                            <group>
                                <field name="independence_threat_ids">
                                    <tree editable="bottom">
                                        <field name="threat_type"/>
                                        <field name="answer"/>
                                        <field name="details"/>
                                        <field name="safeguards"/>
                                    </tree>
                                </field>
                            </group>
                            <group>
                                <field name="non_audit_services_confirmed"/>
                                <field name="non_audit_services_attachment" widget="binary"/>
                            </group>
                            <group>
                                <field name="currency_id" readonly="1"/> 
                                <field name="proposed_audit_fee"/>
                                <field name="total_fee_income"/>
                                <field name="fee_dependency_percent" readonly="1" help="Calculated as proposed audit fee divided by total firm income."/>
                                <field name="fee_dependency_flag" readonly="1"/>
                            </group>
                            <group>
                                <field name="independence_declaration_ids">
                                    <tree editable="bottom">
                                        <field name="user_id"/>
                                        <field name="state"/>
                                        <field name="confirmation_date"/>
                                        <field name="reminder_sent"/>
                                    </tree>
                                </field>
                                <field name="independence_status_feedback" readonly="1"/>
                            </group>
                            <group string="Standards &amp; Checklist">
                                <field name="regulator_checklist_line_ids" domain="[('onboarding_area','=','independence_ethics') ]" modifiers="{'readonly': [('state','in',['partner_approved','locked'])]}" create="false" delete="false">
                                    <tree editable="bottom">
                                        <field name="code" readonly="1"/>
                                        <field name="name" readonly="1"/>
                                        <field name="mandatory" readonly="1"/>
                                        <field name="completed"/>
                                        <field name="completed_by" readonly="1"/>
                                        <field name="completed_on" readonly="1"/>
                                        <field name="standard_ids" widget="many2many_tags" readonly="1"/>
                                        <field name="notes"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="1.6 Predecessor Auditor" name="section_6">
                            <group>
                                <field name="predecessor_auditor_name"/>
                                <field name="predecessor_contact"/>
                                <field name="pcl_requested"/>
                                <field name="pcl_received"/>
                                <field name="pcl_document" filename="pcl_document_name" widget="binary"/>
                                <field name="pcl_no_outstanding_fees"/>
                                <field name="pcl_no_disputes"/>
                                <field name="pcl_no_ethics_issues"/>
                            </group>
                            <group string="Standards &amp; Checklist">
                                <field name="regulator_checklist_line_ids" domain="[('onboarding_area','=','predecessor_auditor') ]" modifiers="{'readonly': [('state','in',['partner_approved','locked'])]}" create="false" delete="false">
                                    <tree editable="bottom">
                                        <field name="code" readonly="1"/>
                                        <field name="name" readonly="1"/>
                                        <field name="mandatory" readonly="1"/>
                                        <field name="completed"/>
                                        <field name="completed_by" readonly="1"/>
                                        <field name="completed_on" readonly="1"/>
                                        <field name="standard_ids" widget="many2many_tags" readonly="1"/>
                                        <field name="notes"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="1.7 Final Authorization" name="section_7">
                            <group>
                                <field name="precondition_line_ids">
                                    <tree editable="bottom">
                                        <field name="description" readonly="1"/>
                                        <field name="confirmed"/>
                                    </tree>
                                </field>
                            </group>
                            <group>
                                <field name="engagement_summary" readonly="1"/>
                                <field name="engagement_decision"/>
                                <field name="engagement_justification"/>
                            </group>
                            <group>
                                <field name="engagement_partner_id"/>
                                <field name="engagement_partner_signature" widget="binary"/>
                                <field name="eqcr_partner_id" invisible="not eqcr_required"/>
                                <field name="eqcr_partner_signature" invisible="not eqcr_required" widget="binary"/>
                                <field name="managing_partner_escalation" readonly="1" invisible="1"/>
                                <field name="managing_partner_id" invisible="not managing_partner_escalation"/>
                                <field name="managing_partner_signature" invisible="not managing_partner_escalation" widget="binary"/>
                            </group>
                            <group string="Standards &amp; Checklist">
                                <field name="regulator_checklist_line_ids" domain="[('onboarding_area','=','engagement_terms') ]" modifiers="{'readonly': [('state','in',['partner_approved','locked'])]}" create="false" delete="false">
                                    <tree editable="bottom">
                                        <field name="code" readonly="1"/>
                                        <field name="name" readonly="1"/>
                                        <field name="mandatory" readonly="1"/>
                                        <field name="completed"/>
                                        <field name="completed_by" readonly="1"/>
                                        <field name="completed_on" readonly="1"/>
                                        <field name="standard_ids" widget="many2many_tags" readonly="1"/>
                                        <field name="notes"/>
                                    </tree>
                                </field>
                                <field name="regulator_checklist_line_ids" domain="[('onboarding_area','=','partner_authorization') ]" modifiers="{'readonly': [('state','in',['partner_approved','locked'])]}" create="false" delete="false">
                                    <tree editable="bottom">
                                        <field name="code" readonly="1"/>
                                        <field name="name" readonly="1"/>
                                        <field name="mandatory" readonly="1"/>
                                        <field name="completed"/>
                                        <field name="completed_by" readonly="1"/>
                                        <field name="completed_on" readonly="1"/>
                                        <field name="standard_ids" widget="many2many_tags" readonly="1"/>
                                        <field name="notes"/>
                                    </tree>
                                </field>
                                <field name="regulator_checklist_line_ids" domain="[('onboarding_area','=','audit_trail') ]" modifiers="{'readonly': [('state','in',['partner_approved','locked'])]}" create="false" delete="false">
                                    <tree editable="bottom">
                                        <field name="code" readonly="1"/>
                                        <field name="name" readonly="1"/>
                                        <field name="mandatory" readonly="1"/>
                                        <field name="completed"/>
                                        <field name="completed_by" readonly="1"/>
                                        <field name="completed_on" readonly="1"/>
                                        <field name="standard_ids" widget="many2many_tags" readonly="1"/>
                                        <field name="notes"/>
                                    </tree>
                                </field>
                            </group>
                            <group string="Compliance Summary">
                                <field name="audit_standard_ids" widget="many2many_tags" modifiers="{'readonly': [('state','in',['partner_approved','locked'])]}"/>
                                <field name="audit_standard_overview" widget="html" readonly="1"/>
                                <field name="regulator_checklist_completion" readonly="1" widget="percentage"/>
                                <field name="regulator_checklist_overview" widget="html" readonly="1"/>
                            </group>
                        </page>
                        <page string="1.8 Document Vault" name="documents">
                            <field name="document_ids">
                                <tree editable="bottom">
                                    <field name="name"/>
                                    <field name="doc_type"/>
                                    <field name="state"/>
                                    <field name="file_name"/>
                                </tree>
                            </field>
                        </page>
                        <page string="1.9 Engagement Partner Decision" name="checklists">
                            <field name="checklist_line_ids">
                                <tree editable="bottom">
                                    <field name="question" readonly="1"/>
                                    <field name="answer"/>
                                    <field name="remarks"/>
                                    <field name="critical" readonly="1"/>
                                </tree>
                            </field>
                        </page>
                        <page string="1.10 Audit Trail" name="audit_trail">
                            <field name="audit_trail_ids">
                                <tree>
                                    <field name="create_date"/>
                                    <field name="user_id"/>
                                    <field name="action"/>
                                    <field name="notes"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
</odoo>
